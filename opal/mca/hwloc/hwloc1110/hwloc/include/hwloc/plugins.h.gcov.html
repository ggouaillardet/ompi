<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - ompi.info - opal/mca/hwloc/hwloc1110/hwloc/include/hwloc/plugins.h</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">opal/mca/hwloc/hwloc1110/hwloc/include/hwloc</a> - plugins.h<span style="font-size: 80%;"> (source / <a href="plugins.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">ompi.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntry">9</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2015-07-30 14:35:26</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntry">1</td>
            <td class="headerCovTableEntryHi">100.0 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  * Copyright Â© 2013-2015 Inria.  All rights reserved.
<span class="lineNum">       3 </span>            :  * See COPYING in top-level directory.
<span class="lineNum">       4 </span>            :  */
<span class="lineNum">       5 </span>            : 
<span class="lineNum">       6 </span>            : #ifndef HWLOC_PLUGINS_H
<span class="lineNum">       7 </span>            : #define HWLOC_PLUGINS_H
<span class="lineNum">       8 </span>            : 
<span class="lineNum">       9 </span>            : /** \file
<span class="lineNum">      10 </span>            :  * \brief Public interface for building hwloc plugins.
<span class="lineNum">      11 </span>            :  */
<span class="lineNum">      12 </span>            : 
<span class="lineNum">      13 </span>            : struct hwloc_backend;
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : #include &lt;hwloc.h&gt;
<span class="lineNum">      16 </span>            : #ifdef HWLOC_INSIDE_PLUGIN
<span class="lineNum">      17 </span>            : /* needed for hwloc_plugin_check_namespace() */
<span class="lineNum">      18 </span>            : #include &lt;ltdl.h&gt;
<span class="lineNum">      19 </span>            : #endif
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : 
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            : /** \defgroup hwlocality_disc_components Components and Plugins: Discovery components
<span class="lineNum">      24 </span>            :  * @{
<span class="lineNum">      25 </span>            :  */
<span class="lineNum">      26 </span>            : 
<span class="lineNum">      27 </span>            : /** \brief Discovery component type */
<span class="lineNum">      28 </span>            : typedef enum hwloc_disc_component_type_e {
<span class="lineNum">      29 </span>            :   /** \brief CPU-only discovery through the OS, or generic no-OS support.
<span class="lineNum">      30 </span>            :    * \hideinitializer */
<span class="lineNum">      31 </span>            :   HWLOC_DISC_COMPONENT_TYPE_CPU = (1&lt;&lt;0),
<span class="lineNum">      32 </span>            : 
<span class="lineNum">      33 </span>            :   /** \brief xml, synthetic or custom,
<span class="lineNum">      34 </span>            :    * platform-specific components such as bgq.
<span class="lineNum">      35 </span>            :    * Anything the discovers CPU and everything else.
<span class="lineNum">      36 </span>            :    * No misc backend is expected to complement a global component.
<span class="lineNum">      37 </span>            :    * \hideinitializer */
<span class="lineNum">      38 </span>            :   HWLOC_DISC_COMPONENT_TYPE_GLOBAL = (1&lt;&lt;1),
<span class="lineNum">      39 </span>            : 
<span class="lineNum">      40 </span>            :   /** \brief OpenCL, Cuda, etc.
<span class="lineNum">      41 </span>            :    * \hideinitializer */
<span class="lineNum">      42 </span>            :   HWLOC_DISC_COMPONENT_TYPE_MISC = (1&lt;&lt;2)
<span class="lineNum">      43 </span>            : } hwloc_disc_component_type_t;
<span class="lineNum">      44 </span>            : 
<span class="lineNum">      45 </span>            : /** \brief Discovery component structure
<span class="lineNum">      46 </span>            :  *
<span class="lineNum">      47 </span>            :  * This is the major kind of components, taking care of the discovery.
<span class="lineNum">      48 </span>            :  * They are registered by generic components, either statically-built or as plugins.
<span class="lineNum">      49 </span>            :  */
<span class="lineNum">      50 </span>            : struct hwloc_disc_component {
<span class="lineNum">      51 </span>            :   /** \brief Discovery component type */
<span class="lineNum">      52 </span>            :   hwloc_disc_component_type_t type;
<span class="lineNum">      53 </span>            : 
<span class="lineNum">      54 </span>            :   /** \brief Name.
<span class="lineNum">      55 </span>            :    * If this component is built as a plugin, this name does not have to match the plugin filename.
<span class="lineNum">      56 </span>            :    */
<span class="lineNum">      57 </span>            :   const char *name;
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            :   /** \brief Component types to exclude, as an OR'ed set of HWLOC_DISC_COMPONENT_TYPE_*.
<span class="lineNum">      60 </span>            :    *
<span class="lineNum">      61 </span>            :    * For a GLOBAL component, this usually includes all other types (~0).
<span class="lineNum">      62 </span>            :    *
<span class="lineNum">      63 </span>            :    * Other components only exclude types that may bring conflicting
<span class="lineNum">      64 </span>            :    * topology information. MISC components should likely not be excluded
<span class="lineNum">      65 </span>            :    * since they usually bring non-primary additional information.
<span class="lineNum">      66 </span>            :    */
<span class="lineNum">      67 </span>            :   unsigned excludes;
<span class="lineNum">      68 </span>            : 
<span class="lineNum">      69 </span>            :   /** \brief Instantiate callback to create a backend from the component.
<span class="lineNum">      70 </span>            :    * Parameters data1, data2, data3 are NULL except for components
<span class="lineNum">      71 </span>            :    * that have special enabling routines such as hwloc_topology_set_xml(). */
<span class="lineNum">      72 </span>            :   struct hwloc_backend * (*instantiate)(struct hwloc_disc_component *component, const void *data1, const void *data2, const void *data3);
<span class="lineNum">      73 </span>            : 
<span class="lineNum">      74 </span>            :   /** \brief Component priority.
<span class="lineNum">      75 </span>            :    * Used to sort topology-&gt;components, higher priority first.
<span class="lineNum">      76 </span>            :    * Also used to decide between two components with the same name.
<span class="lineNum">      77 </span>            :    *
<span class="lineNum">      78 </span>            :    * Usual values are
<span class="lineNum">      79 </span>            :    * 50 for native OS (or platform) components,
<span class="lineNum">      80 </span>            :    * 45 for x86,
<span class="lineNum">      81 </span>            :    * 40 for no-OS fallback,
<span class="lineNum">      82 </span>            :    * 30 for global components (xml/synthetic/custom),
<span class="lineNum">      83 </span>            :    * 20 for pci,
<span class="lineNum">      84 </span>            :    * 10 for other misc components (opencl etc.).
<span class="lineNum">      85 </span>            :    */
<span class="lineNum">      86 </span>            :   unsigned priority;
<span class="lineNum">      87 </span>            : 
<span class="lineNum">      88 </span>            :   /** \private Used internally to list components by priority on topology-&gt;components
<span class="lineNum">      89 </span>            :    * (the component structure is usually read-only,
<span class="lineNum">      90 </span>            :    *  the core copies it before using this field for queueing)
<span class="lineNum">      91 </span>            :    */
<span class="lineNum">      92 </span>            :   struct hwloc_disc_component * next;
<span class="lineNum">      93 </span>            : };
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span>            : /** @} */
<span class="lineNum">      96 </span>            : 
<span class="lineNum">      97 </span>            : 
<span class="lineNum">      98 </span>            : 
<span class="lineNum">      99 </span>            : 
<span class="lineNum">     100 </span>            : /** \defgroup hwlocality_disc_backends Components and Plugins: Discovery backends
<span class="lineNum">     101 </span>            :  * @{
<span class="lineNum">     102 </span>            :  */
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            : /** \brief Discovery backend structure
<span class="lineNum">     105 </span>            :  *
<span class="lineNum">     106 </span>            :  * A backend is the instantiation of a discovery component.
<span class="lineNum">     107 </span>            :  * When a component gets enabled for a topology,
<span class="lineNum">     108 </span>            :  * its instantiate() callback creates a backend.
<span class="lineNum">     109 </span>            :  *
<span class="lineNum">     110 </span>            :  * hwloc_backend_alloc() initializes all fields to default values
<span class="lineNum">     111 </span>            :  * that the component may change (except &quot;component&quot; and &quot;next&quot;)
<span class="lineNum">     112 </span>            :  * before enabling the backend with hwloc_backend_enable().
<span class="lineNum">     113 </span>            :  */
<span class="lineNum">     114 </span>            : struct hwloc_backend {
<span class="lineNum">     115 </span>            :   /** \private Reserved for the core, set by hwloc_backend_alloc() */
<span class="lineNum">     116 </span>            :   struct hwloc_disc_component * component;
<span class="lineNum">     117 </span>            :   /** \private Reserved for the core, set by hwloc_backend_enable() */
<span class="lineNum">     118 </span>            :   struct hwloc_topology * topology;
<span class="lineNum">     119 </span>            :   /** \private Reserved for the core. Set to 1 if forced through envvar, 0 otherwise. */
<span class="lineNum">     120 </span>            :   int envvar_forced;
<span class="lineNum">     121 </span>            :   /** \private Reserved for the core. Used internally to list backends topology-&gt;backends. */
<span class="lineNum">     122 </span>            :   struct hwloc_backend * next;
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span>            :   /** \brief Backend flags, as an OR'ed set of HWLOC_BACKEND_FLAG_* */
<span class="lineNum">     125 </span>            :   unsigned long flags;
<span class="lineNum">     126 </span>            : 
<span class="lineNum">     127 </span>            :   /** \brief Backend-specific 'is_custom' property.
<span class="lineNum">     128 </span>            :    * Shortcut on !strcmp(..-&gt;component-&gt;name, &quot;custom&quot;).
<span class="lineNum">     129 </span>            :    * Only the custom component should touch this. */
<span class="lineNum">     130 </span>            :   int is_custom;
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span>            :   /** \brief Backend-specific 'is_thissystem' property.
<span class="lineNum">     133 </span>            :    * Set to 0 or 1 if the backend should enforce the thissystem flag when it gets enabled.
<span class="lineNum">     134 </span>            :    * Set to -1 if the backend doesn't care (default). */
<span class="lineNum">     135 </span>            :   int is_thissystem;
<span class="lineNum">     136 </span>            : 
<span class="lineNum">     137 </span>            :   /** \brief Backend private data, or NULL if none. */
<span class="lineNum">     138 </span>            :   void * private_data;
<span class="lineNum">     139 </span>            :   /** \brief Callback for freeing the private_data.
<span class="lineNum">     140 </span>            :    * May be NULL.
<span class="lineNum">     141 </span>            :    */
<span class="lineNum">     142 </span>            :   void (*disable)(struct hwloc_backend *backend);
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span>            :   /** \brief Main discovery callback.
<span class="lineNum">     145 </span>            :    * returns &gt; 0 if it modified the topology tree, -1 on error, 0 otherwise.
<span class="lineNum">     146 </span>            :    * May be NULL if type is HWLOC_DISC_COMPONENT_TYPE_MISC. */
<span class="lineNum">     147 </span>            :   int (*discover)(struct hwloc_backend *backend);
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span>            :   /** \brief Callback used by the PCI backend to retrieve the locality of a PCI object from the OS/cpu backend.
<span class="lineNum">     150 </span>            :    * May be NULL. */
<span class="lineNum">     151 </span>            :   int (*get_obj_cpuset)(struct hwloc_backend *backend, struct hwloc_backend *caller, struct hwloc_obj *obj, hwloc_bitmap_t cpuset);
<span class="lineNum">     152 </span>            : 
<span class="lineNum">     153 </span>            :   /** \brief Callback called by backends to notify this backend that a new object was added.
<span class="lineNum">     154 </span>            :    * returns &gt; 0 if it modified the topology tree, 0 otherwise.
<span class="lineNum">     155 </span>            :    * May be NULL. */
<span class="lineNum">     156 </span>            :   int (*notify_new_object)(struct hwloc_backend *backend, struct hwloc_backend *caller, struct hwloc_obj *obj);
<span class="lineNum">     157 </span>            : };
<span class="lineNum">     158 </span>            : 
<span class="lineNum">     159 </span>            : /** \brief Backend flags */
<span class="lineNum">     160 </span>            : enum hwloc_backend_flag_e {
<span class="lineNum">     161 </span>            :   /** \brief Levels should be reconnected before this backend discover() is used.
<span class="lineNum">     162 </span>            :    * \hideinitializer */
<span class="lineNum">     163 </span>            :   HWLOC_BACKEND_FLAG_NEED_LEVELS = (1UL&lt;&lt;0)
<span class="lineNum">     164 </span>            : };
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : /** \brief Allocate a backend structure, set good default values, initialize backend-&gt;component and topology, etc.
<span class="lineNum">     167 </span>            :  * The caller will then modify whatever needed, and call hwloc_backend_enable().
<span class="lineNum">     168 </span>            :  */
<span class="lineNum">     169 </span>            : HWLOC_DECLSPEC struct hwloc_backend * hwloc_backend_alloc(struct hwloc_disc_component *component);
<span class="lineNum">     170 </span>            : 
<span class="lineNum">     171 </span>            : /** \brief Enable a previously allocated and setup backend. */
<span class="lineNum">     172 </span>            : HWLOC_DECLSPEC int hwloc_backend_enable(struct hwloc_topology *topology, struct hwloc_backend *backend);
<span class="lineNum">     173 </span>            : 
<span class="lineNum">     174 </span>            : /** \brief Used by backends discovery callbacks to request locality information from others.
<span class="lineNum">     175 </span>            :  *
<span class="lineNum">     176 </span>            :  * Traverse the list of enabled backends until one has a
<span class="lineNum">     177 </span>            :  * get_obj_cpuset() method, and call it.
<span class="lineNum">     178 </span>            :  */
<span class="lineNum">     179 </span>            : HWLOC_DECLSPEC int hwloc_backends_get_obj_cpuset(struct hwloc_backend *caller, struct hwloc_obj *obj, hwloc_bitmap_t cpuset);
<span class="lineNum">     180 </span>            : 
<span class="lineNum">     181 </span>            : /** \brief Used by backends discovery callbacks to notify other
<span class="lineNum">     182 </span>            :  * backends of new objects.
<span class="lineNum">     183 </span>            :  *
<span class="lineNum">     184 </span>            :  * Traverse the list of enabled backends (all but caller) and invoke
<span class="lineNum">     185 </span>            :  * their notify_new_object() method to notify them that a new object
<span class="lineNum">     186 </span>            :  * just got added to the topology.
<span class="lineNum">     187 </span>            :  *
<span class="lineNum">     188 </span>            :  * Currently only used for notifying of new PCI device objects.
<span class="lineNum">     189 </span>            :  */
<span class="lineNum">     190 </span>            : HWLOC_DECLSPEC int hwloc_backends_notify_new_object(struct hwloc_backend *caller, struct hwloc_obj *obj);
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            : /** @} */
<span class="lineNum">     193 </span>            : 
<span class="lineNum">     194 </span>            : 
<span class="lineNum">     195 </span>            : 
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            : /** \defgroup hwlocality_generic_components Components and Plugins: Generic components
<span class="lineNum">     198 </span>            :  * @{
<span class="lineNum">     199 </span>            :  */
<span class="lineNum">     200 </span>            : 
<span class="lineNum">     201 </span>            : /** \brief Generic component type */
<span class="lineNum">     202 </span>            : typedef enum hwloc_component_type_e {
<span class="lineNum">     203 </span>            :   /** \brief The data field must point to a struct hwloc_disc_component. */
<span class="lineNum">     204 </span>            :   HWLOC_COMPONENT_TYPE_DISC,
<span class="lineNum">     205 </span>            : 
<span class="lineNum">     206 </span>            :   /** \brief The data field must point to a struct hwloc_xml_component. */
<span class="lineNum">     207 </span>            :   HWLOC_COMPONENT_TYPE_XML
<span class="lineNum">     208 </span>            : } hwloc_component_type_t;
<span class="lineNum">     209 </span>            : 
<span class="lineNum">     210 </span>            : /** \brief Generic component structure
<span class="lineNum">     211 </span>            :  *
<span class="lineNum">     212 </span>            :  * Generic components structure, either statically listed by configure in static-components.h
<span class="lineNum">     213 </span>            :  * or dynamically loaded as a plugin.
<span class="lineNum">     214 </span>            :  */
<span class="lineNum">     215 </span>            : struct hwloc_component {
<span class="lineNum">     216 </span>            :   /** \brief Component ABI version, set to HWLOC_COMPONENT_ABI */
<span class="lineNum">     217 </span>            :   unsigned abi;
<span class="lineNum">     218 </span>            : 
<span class="lineNum">     219 </span>            :   /** \brief Process-wide component initialization callback.
<span class="lineNum">     220 </span>            :    *
<span class="lineNum">     221 </span>            :    * This optional callback is called when the component is registered
<span class="lineNum">     222 </span>            :    * to the hwloc core (after loading the plugin).
<span class="lineNum">     223 </span>            :    *
<span class="lineNum">     224 </span>            :    * When the component is built as a plugin, this callback
<span class="lineNum">     225 </span>            :    * should call hwloc_check_plugin_namespace()
<span class="lineNum">     226 </span>            :    * and return an negative error code on error.
<span class="lineNum">     227 </span>            :    *
<span class="lineNum">     228 </span>            :    * \p flags is always 0 for now.
<span class="lineNum">     229 </span>            :    *
<span class="lineNum">     230 </span>            :    * \return 0 on success, or a negative code on error.
<span class="lineNum">     231 </span>            :    *
<span class="lineNum">     232 </span>            :    * \note If the component uses ltdl for loading its own plugins,
<span class="lineNum">     233 </span>            :    * it should load/unload them only in init() and finalize(),
<span class="lineNum">     234 </span>            :    * to avoid race conditions with hwloc's use of ltdl.
<span class="lineNum">     235 </span>            :    */
<span class="lineNum">     236 </span>            :   int (*init)(unsigned long flags);
<span class="lineNum">     237 </span>            : 
<span class="lineNum">     238 </span>            :   /** \brief Process-wide component termination callback.
<span class="lineNum">     239 </span>            :    *
<span class="lineNum">     240 </span>            :    * This optional callback is called after unregistering the component
<span class="lineNum">     241 </span>            :    * from the hwloc core (before unloading the plugin).
<span class="lineNum">     242 </span>            :    *
<span class="lineNum">     243 </span>            :    * \p flags is always 0 for now.
<span class="lineNum">     244 </span>            :    *
<span class="lineNum">     245 </span>            :    * \note If the component uses ltdl for loading its own plugins,
<span class="lineNum">     246 </span>            :    * it should load/unload them only in init() and finalize(),
<span class="lineNum">     247 </span>            :    * to avoid race conditions with hwloc's use of ltdl.
<span class="lineNum">     248 </span>            :    */
<span class="lineNum">     249 </span>            :   void (*finalize)(unsigned long flags);
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span>            :   /** \brief Component type */
<span class="lineNum">     252 </span>            :   hwloc_component_type_t type;
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span>            :   /** \brief Component flags, unused for now */
<span class="lineNum">     255 </span>            :   unsigned long flags;
<span class="lineNum">     256 </span>            : 
<span class="lineNum">     257 </span>            :   /** \brief Component data, pointing to a struct hwloc_disc_component or struct hwloc_xml_component. */
<span class="lineNum">     258 </span>            :   void * data;
<span class="lineNum">     259 </span>            : };
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span>            : /** @} */
<span class="lineNum">     262 </span>            : 
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span>            : 
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span>            : /** \defgroup hwlocality_components_core_funcs Components and Plugins: Core functions to be used by components
<span class="lineNum">     267 </span>            :  * @{
<span class="lineNum">     268 </span>            :  */
<span class="lineNum">     269 </span>            : 
<span class="lineNum">     270 </span>            : /** \brief Add an object to the topology.
<span class="lineNum">     271 </span>            :  *
<span class="lineNum">     272 </span>            :  * It is sorted along the tree of other objects according to the inclusion of
<span class="lineNum">     273 </span>            :  * cpusets, to eventually be added as a child of the smallest object including
<span class="lineNum">     274 </span>            :  * this object.
<span class="lineNum">     275 </span>            :  *
<span class="lineNum">     276 </span>            :  * If the cpuset is empty, the type of the object (and maybe some attributes)
<span class="lineNum">     277 </span>            :  * must be enough to find where to insert the object. This is especially true
<span class="lineNum">     278 </span>            :  * for NUMA nodes with memory and no CPUs.
<span class="lineNum">     279 </span>            :  *
<span class="lineNum">     280 </span>            :  * The given object should not have children.
<span class="lineNum">     281 </span>            :  *
<span class="lineNum">     282 </span>            :  * This shall only be called before levels are built.
<span class="lineNum">     283 </span>            :  *
<span class="lineNum">     284 </span>            :  * In case of error, hwloc_report_os_error() is called.
<span class="lineNum">     285 </span>            :  *
<span class="lineNum">     286 </span>            :  * Returns the object on success.
<span class="lineNum">     287 </span>            :  * Returns NULL and frees obj on error.
<span class="lineNum">     288 </span>            :  * Returns another object and frees obj if it was merged with an identical pre-existing object.
<span class="lineNum">     289 </span>            :  */
<span class="lineNum">     290 </span>            : HWLOC_DECLSPEC struct hwloc_obj *hwloc_insert_object_by_cpuset(struct hwloc_topology *topology, hwloc_obj_t obj);
<span class="lineNum">     291 </span>            : 
<span class="lineNum">     292 </span>            : /** \brief Type of error callbacks during object insertion */
<span class="lineNum">     293 </span>            : typedef void (*hwloc_report_error_t)(const char * msg, int line);
<span class="lineNum">     294 </span>            : /** \brief Report an insertion error from a backend */
<span class="lineNum">     295 </span>            : HWLOC_DECLSPEC void hwloc_report_os_error(const char * msg, int line);
<span class="lineNum">     296 </span>            : /** \brief Check whether insertion errors are hidden */
<span class="lineNum">     297 </span>            : HWLOC_DECLSPEC int hwloc_hide_errors(void);
<span class="lineNum">     298 </span>            : 
<span class="lineNum">     299 </span>            : /** \brief Add an object to the topology and specify which error callback to use.
<span class="lineNum">     300 </span>            :  *
<span class="lineNum">     301 </span>            :  * Aside from the error callback selection, this function is identical to hwloc_insert_object_by_cpuset()
<span class="lineNum">     302 </span>            :  */
<span class="lineNum">     303 </span>            : HWLOC_DECLSPEC struct hwloc_obj *hwloc__insert_object_by_cpuset(struct hwloc_topology *topology, hwloc_obj_t obj, hwloc_report_error_t report_error);
<span class="lineNum">     304 </span>            : 
<span class="lineNum">     305 </span>            : /** \brief Insert an object somewhere in the topology.
<span class="lineNum">     306 </span>            :  *
<span class="lineNum">     307 </span>            :  * It is added as the last child of the given parent.
<span class="lineNum">     308 </span>            :  * The cpuset is completely ignored, so strange objects such as I/O devices should
<span class="lineNum">     309 </span>            :  * preferably be inserted with this.
<span class="lineNum">     310 </span>            :  *
<span class="lineNum">     311 </span>            :  * When used for &quot;normal&quot; children with cpusets (when importing from XML
<span class="lineNum">     312 </span>            :  * when duplicating a topology), the caller should make sure children are inserted
<span class="lineNum">     313 </span>            :  * in order.
<span class="lineNum">     314 </span>            :  *
<span class="lineNum">     315 </span>            :  * The given object may have children.
<span class="lineNum">     316 </span>            :  *
<span class="lineNum">     317 </span>            :  * Remember to call topology_connect() afterwards to fix handy pointers.
<span class="lineNum">     318 </span>            :  */
<span class="lineNum">     319 </span>            : HWLOC_DECLSPEC void hwloc_insert_object_by_parent(struct hwloc_topology *topology, hwloc_obj_t parent, hwloc_obj_t obj);
<span class="lineNum">     320 </span>            : 
<a name="321"><span class="lineNum">     321 </span>            : /** \brief Allocate and initialize an object of the given type and physical index */</a>
<span class="lineNum">     322 </span>            : static __hwloc_inline struct hwloc_obj *
<span class="lineNum">     323 </span><span class="lineCov">         70 : hwloc_alloc_setup_object(hwloc_obj_type_t type, signed os_index)</span>
<span class="lineNum">     324 </span>            : {
<span class="lineNum">     325 </span><span class="lineCov">         70 :   struct hwloc_obj *obj = malloc(sizeof(*obj));</span>
<span class="lineNum">     326 </span><span class="lineCov">         70 :   memset(obj, 0, sizeof(*obj));</span>
<span class="lineNum">     327 </span><span class="lineCov">         70 :   obj-&gt;type = type;</span>
<span class="lineNum">     328 </span><span class="lineCov">         70 :   obj-&gt;os_index = os_index;</span>
<span class="lineNum">     329 </span><span class="lineCov">         70 :   obj-&gt;os_level = -1;</span>
<span class="lineNum">     330 </span><span class="lineCov">         70 :   obj-&gt;attr = malloc(sizeof(*obj-&gt;attr));</span>
<span class="lineNum">     331 </span><span class="lineCov">         70 :   memset(obj-&gt;attr, 0, sizeof(*obj-&gt;attr));</span>
<span class="lineNum">     332 </span>            :   /* do not allocate the cpuset here, let the caller do it */
<span class="lineNum">     333 </span><span class="lineCov">         70 :   return obj;</span>
<span class="lineNum">     334 </span>            : }
<span class="lineNum">     335 </span>            : 
<span class="lineNum">     336 </span>            : /** \brief Setup object cpusets/nodesets by OR'ing its children.
<span class="lineNum">     337 </span>            :  *
<span class="lineNum">     338 </span>            :  * Used when adding an object late in the topology, after propagating sets up and down.
<span class="lineNum">     339 </span>            :  * The caller should use this after inserting by cpuset (which means the cpusets is already OK).
<span class="lineNum">     340 </span>            :  * Typical case: PCI backend adding a hostbridge parent.
<span class="lineNum">     341 </span>            :  */
<span class="lineNum">     342 </span>            : HWLOC_DECLSPEC int hwloc_fill_object_sets(hwloc_obj_t obj);
<span class="lineNum">     343 </span>            : 
<span class="lineNum">     344 </span>            : /** \brief Make sure that plugins can lookup core symbols.
<span class="lineNum">     345 </span>            :  *
<span class="lineNum">     346 </span>            :  * This is a sanity check to avoid lazy-lookup failures when libhwloc
<span class="lineNum">     347 </span>            :  * is loaded within a plugin, and later tries to load its own plugins.
<span class="lineNum">     348 </span>            :  * This may fail (and abort the program) if libhwloc symbols are in a
<span class="lineNum">     349 </span>            :  * private namespace.
<span class="lineNum">     350 </span>            :  *
<span class="lineNum">     351 </span>            :  * \return 0 on success.
<span class="lineNum">     352 </span>            :  * \return -1 if the plugin cannot be successfully loaded. The caller
<span class="lineNum">     353 </span>            :  * plugin init() callback should return a negative error code as well.
<span class="lineNum">     354 </span>            :  *
<span class="lineNum">     355 </span>            :  * Plugins should call this function in their init() callback to avoid
<span class="lineNum">     356 </span>            :  * later crashes if lazy symbol resolution is used by the upper layer that
<span class="lineNum">     357 </span>            :  * loaded hwloc (e.g. OpenCL implementations using dlopen with RTLD_LAZY).
<span class="lineNum">     358 </span>            :  *
<span class="lineNum">     359 </span>            :  * \note The build system must define HWLOC_INSIDE_PLUGIN if and only if
<span class="lineNum">     360 </span>            :  * building the caller as a plugin.
<span class="lineNum">     361 </span>            :  *
<span class="lineNum">     362 </span>            :  * \note This function should remain inline so plugins can call it even
<span class="lineNum">     363 </span>            :  * when they cannot find libhwloc symbols.
<span class="lineNum">     364 </span>            :  */
<span class="lineNum">     365 </span>            : static __hwloc_inline int
<span class="lineNum">     366 </span>            : hwloc_plugin_check_namespace(const char *pluginname __hwloc_attribute_unused, const char *symbol __hwloc_attribute_unused)
<span class="lineNum">     367 </span>            : {
<span class="lineNum">     368 </span>            : #ifdef HWLOC_INSIDE_PLUGIN
<span class="lineNum">     369 </span>            :   lt_dlhandle handle;
<span class="lineNum">     370 </span>            :   void *sym;
<span class="lineNum">     371 </span>            :   handle = lt_dlopen(NULL);
<span class="lineNum">     372 </span>            :   if (!handle)
<span class="lineNum">     373 </span>            :     /* cannot check, assume things will work */
<span class="lineNum">     374 </span>            :     return 0;
<span class="lineNum">     375 </span>            :   sym = lt_dlsym(handle, symbol);
<span class="lineNum">     376 </span>            :   lt_dlclose(handle);
<span class="lineNum">     377 </span>            :   if (!sym) {
<span class="lineNum">     378 </span>            :     static int verboseenv_checked = 0;
<span class="lineNum">     379 </span>            :     static int verboseenv_value = 0;
<span class="lineNum">     380 </span>            :     if (!verboseenv_checked) {
<span class="lineNum">     381 </span>            :       const char *verboseenv = getenv(&quot;HWLOC_PLUGINS_VERBOSE&quot;);
<span class="lineNum">     382 </span>            :       verboseenv_value = atoi(verboseenv);
<span class="lineNum">     383 </span>            :       verboseenv_checked = 1;
<span class="lineNum">     384 </span>            :     }
<span class="lineNum">     385 </span>            :     if (verboseenv_value)
<span class="lineNum">     386 </span>            :       fprintf(stderr, &quot;Plugin `%s' disabling itself because it cannot find the `%s' core symbol.\n&quot;,
<span class="lineNum">     387 </span>            :               pluginname, symbol);
<span class="lineNum">     388 </span>            :     return -1;
<span class="lineNum">     389 </span>            :   }
<span class="lineNum">     390 </span>            : #endif /* HWLOC_INSIDE_PLUGIN */
<span class="lineNum">     391 </span>            :   return 0;
<span class="lineNum">     392 </span>            : }
<span class="lineNum">     393 </span>            : 
<span class="lineNum">     394 </span>            : /** @} */
<span class="lineNum">     395 </span>            : 
<span class="lineNum">     396 </span>            : 
<span class="lineNum">     397 </span>            : 
<span class="lineNum">     398 </span>            : 
<span class="lineNum">     399 </span>            : /** \defgroup hwlocality_components_pci_funcs Components and Plugins: PCI functions to be used by components
<span class="lineNum">     400 </span>            :  * @{
<span class="lineNum">     401 </span>            :  */
<span class="lineNum">     402 </span>            : 
<span class="lineNum">     403 </span>            : /** \brief Insert a list of PCI devices and bridges in the backend topology.
<span class="lineNum">     404 </span>            :  *
<span class="lineNum">     405 </span>            :  * Insert a list of objects (either PCI device or bridges) starting at first_obj
<span class="lineNum">     406 </span>            :  * (linked by next_sibling in the topology, and ending with NULL).
<span class="lineNum">     407 </span>            :  * Objects are placed under the right bridges, and the remaining upstream bridges
<span class="lineNum">     408 </span>            :  * are then inserted in the topology by calling the get_obj_cpuset() callback to
<span class="lineNum">     409 </span>            :  * find their locality.
<span class="lineNum">     410 </span>            :  */
<span class="lineNum">     411 </span>            : HWLOC_DECLSPEC int hwloc_insert_pci_device_list(struct hwloc_backend *backend, struct hwloc_obj *first_obj);
<span class="lineNum">     412 </span>            : 
<span class="lineNum">     413 </span>            : /** \brief Return the offset of the given capability in the PCI config space buffer
<span class="lineNum">     414 </span>            :  *
<span class="lineNum">     415 </span>            :  * This function requires a 256-bytes config space. Unknown/unavailable bytes should be set to 0xff.
<span class="lineNum">     416 </span>            :  */
<span class="lineNum">     417 </span>            : HWLOC_DECLSPEC unsigned hwloc_pci_find_cap(const unsigned char *config, unsigned cap);
<span class="lineNum">     418 </span>            : 
<span class="lineNum">     419 </span>            : /** \brief Fill linkspeed by reading the PCI config space where PCI_CAP_ID_EXP is at position offset.
<span class="lineNum">     420 </span>            :  *
<span class="lineNum">     421 </span>            :  * Needs 20 bytes of EXP capability block starting at offset in the config space
<span class="lineNum">     422 </span>            :  * for registers up to link status.
<span class="lineNum">     423 </span>            :  */
<span class="lineNum">     424 </span>            : HWLOC_DECLSPEC int hwloc_pci_find_linkspeed(const unsigned char *config, unsigned offset, float *linkspeed);
<span class="lineNum">     425 </span>            : 
<span class="lineNum">     426 </span>            : /** \brief Modify the PCI device object into a bridge and fill its attribute if a bridge is found in the PCI config space.
<span class="lineNum">     427 </span>            :  *
<span class="lineNum">     428 </span>            :  * This function requires 64 bytes of common configuration header at the beginning of config.
<span class="lineNum">     429 </span>            :  */
<span class="lineNum">     430 </span>            : HWLOC_DECLSPEC int hwloc_pci_prepare_bridge(hwloc_obj_t obj, const unsigned char *config);
<span class="lineNum">     431 </span>            : 
<span class="lineNum">     432 </span>            : /** @} */
<span class="lineNum">     433 </span>            : 
<span class="lineNum">     434 </span>            : 
<span class="lineNum">     435 </span>            : 
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span>            : #endif /* HWLOC_PLUGINS_H */
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
