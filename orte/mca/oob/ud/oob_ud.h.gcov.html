<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - master-ibm-intel - orte/mca/oob/ud/oob_ud.h</title>
  <link rel="stylesheet" type="text/css" href="../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../index.html">top level</a> - <a href="index.html">orte/mca/oob/ud</a> - oob_ud.h<span style="font-size: 80%;"> (source / <a href="oob_ud.h.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">master-ibm-intel</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">22</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2015-07-30 16:27:56</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">3</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- Mode: C; c-basic-offset:4 ; indent-tabs-mode:nil -*- */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  * Copyright (c) 2011-2015 Los Alamos National Security, LLC. All rights
<span class="lineNum">       4 </span>            :  *                         reserved.
<span class="lineNum">       5 </span>            :  * Copyright (c) 2014      Research Organization for Information Science
<span class="lineNum">       6 </span>            :  *                         and Technology (RIST). All rights reserved.
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  *               2014      Mellanox Technologies, Inc.
<span class="lineNum">       9 </span>            :  *                         All rights reserved.
<span class="lineNum">      10 </span>            :  * $COPYRIGHT$
<span class="lineNum">      11 </span>            :  *
<span class="lineNum">      12 </span>            :  * Additional copyrights may follow
<span class="lineNum">      13 </span>            :  *
<span class="lineNum">      14 </span>            :  * $HEADER$
<span class="lineNum">      15 </span>            :  *
<span class="lineNum">      16 </span>            :  */
<span class="lineNum">      17 </span>            : 
<span class="lineNum">      18 </span>            : #if !defined(MCA_OOB_UD_H)
<span class="lineNum">      19 </span>            : #define MCA_OOB_UD_H
<span class="lineNum">      20 </span>            : 
<span class="lineNum">      21 </span>            : #include &quot;orte_config.h&quot;
<span class="lineNum">      22 </span>            : 
<span class="lineNum">      23 </span>            : #ifdef HAVE_SYS_TYPES_H
<span class="lineNum">      24 </span>            : #include &lt;sys/types.h&gt;
<span class="lineNum">      25 </span>            : #endif
<span class="lineNum">      26 </span>            : #include &lt;math.h&gt;
<span class="lineNum">      27 </span>            : #include &lt;infiniband/verbs.h&gt;
<span class="lineNum">      28 </span>            : 
<span class="lineNum">      29 </span>            : #include &quot;opal/types.h&quot;
<span class="lineNum">      30 </span>            : #include &quot;orte/types.h&quot;
<span class="lineNum">      31 </span>            : 
<span class="lineNum">      32 </span>            : #include &quot;opal/mca/base/base.h&quot;
<span class="lineNum">      33 </span>            : #include &quot;opal/class/opal_free_list.h&quot;
<span class="lineNum">      34 </span>            : #include &quot;opal/class/opal_hash_table.h&quot;
<span class="lineNum">      35 </span>            : #include &quot;opal/threads/mutex.h&quot;
<span class="lineNum">      36 </span>            : #include &quot;opal/threads/condition.h&quot;
<span class="lineNum">      37 </span>            : #include &quot;opal/threads/threads.h&quot;
<span class="lineNum">      38 </span>            : #include &quot;opal/mca/timer/base/base.h&quot;
<span class="lineNum">      39 </span>            : #include &quot;opal/include/opal_stdint.h&quot;
<span class="lineNum">      40 </span>            : #include &quot;opal/mca/memchecker/base/base.h&quot;
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            : #include &quot;orte/mca/oob/oob.h&quot;
<span class="lineNum">      43 </span>            : #include &quot;orte/mca/oob/base/base.h&quot;
<span class="lineNum">      44 </span>            : #include &quot;orte/util/name_fns.h&quot;
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : #include &quot;orte/runtime/orte_globals.h&quot;
<span class="lineNum">      47 </span>            : 
<span class="lineNum">      48 </span>            : #include &quot;oob_ud_qp.h&quot;
<span class="lineNum">      49 </span>            : #include &quot;oob_ud_peer.h&quot;
<span class="lineNum">      50 </span>            : #include &quot;oob_ud_req.h&quot;
<span class="lineNum">      51 </span>            : 
<span class="lineNum">      52 </span>            : /* Use for valgrind checks*/
<span class="lineNum">      53 </span>            : #ifdef HAVE_VALGRIND
<span class="lineNum">      54 </span>            : #include &lt;valgrind/memcheck.h&gt;
<span class="lineNum">      55 </span>            : #else
<span class="lineNum">      56 </span>            : #define VALGRIND_MAKE_MEM_DEFINED(addr,len)
<span class="lineNum">      57 </span>            : #endif
<span class="lineNum">      58 </span>            : 
<span class="lineNum">      59 </span>            : BEGIN_C_DECLS
<span class="lineNum">      60 </span>            : 
<span class="lineNum">      61 </span>            : enum {
<span class="lineNum">      62 </span>            :     MCA_OOB_UD_SEND_WR = 0x10000000,
<span class="lineNum">      63 </span>            :     MCA_OOB_UD_RECV_WR = 0x20000000
<span class="lineNum">      64 </span>            : };
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span>            : enum {
<span class="lineNum">      67 </span>            :     MCA_OOB_UD_DEBUG_NONE,
<span class="lineNum">      68 </span>            :     MCA_OOB_UD_DEBUG_ALL
<a name="69"><span class="lineNum">      69 </span>            : };</a>
<span class="lineNum">      70 </span>            : 
<span class="lineNum">      71 </span><span class="lineNoCov">          0 : static inline void mca_oob_ud_fill_send_wr (struct ibv_send_wr *wr, struct ibv_sge *sge,</span>
<span class="lineNum">      72 </span>            :                                             int num_sge, const mca_oob_ud_peer_t *peer)
<span class="lineNum">      73 </span>            : {
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :     wr-&gt;wr_id      = MCA_OOB_UD_SEND_WR;</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :     wr-&gt;next       = NULL;</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :     wr-&gt;sg_list    = sge;</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :     wr-&gt;num_sge    = num_sge;</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :     wr-&gt;opcode     = IBV_WR_SEND;</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     wr-&gt;send_flags = IBV_SEND_SIGNALED;</span>
<span class="lineNum">      80 </span>            : 
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :     wr-&gt;wr.ud.ah          = peer-&gt;peer_ah;</span>
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :     wr-&gt;wr.ud.remote_qpn  = peer-&gt;peer_qpn;</span>
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     wr-&gt;wr.ud.remote_qkey = peer-&gt;peer_qkey;</span>
<a name="84"><span class="lineNum">      84 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      85 </span>            : 
<span class="lineNum">      86 </span><span class="lineNoCov">          0 : static inline void mca_oob_ud_fill_recv_wr (struct ibv_recv_wr *wr, struct ibv_sge *sge,</span>
<span class="lineNum">      87 </span>            :                                             int num_sge)
<span class="lineNum">      88 </span>            : {
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :     wr-&gt;wr_id   = MCA_OOB_UD_RECV_WR;</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :     wr-&gt;next    = NULL;</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :     wr-&gt;sg_list = sge;</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :     wr-&gt;num_sge = num_sge;</span>
<a name="93"><span class="lineNum">      93 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">      94 </span>            : 
<span class="lineNum">      95 </span><span class="lineNoCov">          0 : static inline void mca_oob_ud_fill_sge (struct ibv_sge *sge, void *addr,</span>
<span class="lineNum">      96 </span>            :                                         uint32_t length, uint32_t lkey)
<span class="lineNum">      97 </span>            : {
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :     sge-&gt;addr   = (uint64_t)addr;</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :     sge-&gt;length = length;</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :     sge-&gt;lkey   = lkey;</span>
<span class="lineNum">     101 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : 
<span class="lineNum">     104 </span>            : struct mca_oob_ud_device_t {
<span class="lineNum">     105 </span>            :     opal_list_item_t super;
<span class="lineNum">     106 </span>            :     struct ibv_device_attr  attr;
<span class="lineNum">     107 </span>            :     struct ibv_context      *ib_context;
<span class="lineNum">     108 </span>            :     struct ibv_comp_channel *ib_channel;
<span class="lineNum">     109 </span>            :     struct ibv_pd           *ib_pd;
<span class="lineNum">     110 </span>            : 
<span class="lineNum">     111 </span>            :     opal_event_t event;
<span class="lineNum">     112 </span>            : 
<span class="lineNum">     113 </span>            :     opal_list_t ports;
<span class="lineNum">     114 </span>            : };
<span class="lineNum">     115 </span>            : 
<span class="lineNum">     116 </span>            : typedef struct mca_oob_ud_device_t mca_oob_ud_device_t;
<span class="lineNum">     117 </span>            : OBJ_CLASS_DECLARATION(mca_oob_ud_device_t);
<span class="lineNum">     118 </span>            : 
<span class="lineNum">     119 </span>            : /* events */
<span class="lineNum">     120 </span>            : void mca_oob_ud_event_start_monitor (mca_oob_ud_device_t *device);
<span class="lineNum">     121 </span>            : void mca_oob_ud_event_stop_monitor (mca_oob_ud_device_t *device);
<span class="lineNum">     122 </span>            : 
<span class="lineNum">     123 </span>            : struct mca_oob_ud_reg_mem_t {
<span class="lineNum">     124 </span>            :     char          *ptr;
<span class="lineNum">     125 </span>            :     size_t         len;
<span class="lineNum">     126 </span>            :     struct ibv_mr *mr;
<span class="lineNum">     127 </span>            : };
<span class="lineNum">     128 </span>            : typedef struct mca_oob_ud_reg_mem_t mca_oob_ud_reg_mem_t;
<span class="lineNum">     129 </span>            : 
<span class="lineNum">     130 </span>            : struct mca_oob_ud_port_t {
<span class="lineNum">     131 </span>            :     opal_list_item_t    super;
<span class="lineNum">     132 </span>            :     mca_oob_ud_device_t *device;
<span class="lineNum">     133 </span>            :     mca_oob_ud_qp_t      listen_qp;
<span class="lineNum">     134 </span>            :     opal_free_list_t     data_qps;
<span class="lineNum">     135 </span>            :     opal_free_list_t     free_msgs;
<span class="lineNum">     136 </span>            :     int                  mtu;
<span class="lineNum">     137 </span>            :     uint16_t             lid;
<span class="lineNum">     138 </span>            :     uint8_t              port_num;
<span class="lineNum">     139 </span>            :     /** current send buffer index. used by init function for free_msgs member */
<span class="lineNum">     140 </span>            :     int                  send_buffer_index;
<span class="lineNum">     141 </span>            : 
<span class="lineNum">     142 </span>            :     mca_oob_ud_reg_mem_t grh_buf;
<span class="lineNum">     143 </span>            :     mca_oob_ud_reg_mem_t msg_buf;
<span class="lineNum">     144 </span>            : };
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span>            : typedef struct mca_oob_ud_port_t mca_oob_ud_port_t;
<span class="lineNum">     147 </span>            : OBJ_CLASS_DECLARATION(mca_oob_ud_port_t);
<span class="lineNum">     148 </span>            : 
<span class="lineNum">     149 </span>            : 
<span class="lineNum">     150 </span>            : int mca_oob_ud_port_post_one_recv (mca_oob_ud_port_t *port, int msg_num);
<span class="lineNum">     151 </span>            : 
<span class="lineNum">     152 </span>            : void mca_oob_ud_port_get_uri (mca_oob_ud_port_t *port, char *uri);
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span>            : /* Module definition */
<span class="lineNum">     155 </span>            : typedef int (*mca_oob_ud_module_init_fn_t)(void);
<span class="lineNum">     156 </span>            : typedef void (*mca_oob_ud_module_fini_fn_t)(mca_oob_ud_peer_t **peer);
<span class="lineNum">     157 </span>            : typedef int  (*mca_oob_ud_set_addr_fn_t)(const orte_process_name_t *name, const char *uri);
<span class="lineNum">     158 </span>            : typedef void  (*mca_oob_ud_ping_fn_t)(const orte_process_name_t *proc);
<span class="lineNum">     159 </span>            : typedef void  (*mca_oob_ud_send_nb_fn_t)(orte_rml_send_t *msg);
<span class="lineNum">     160 </span>            : typedef int  (*mca_oob_ud_recv_nb_fn_t)(orte_process_name_t* peer,
<span class="lineNum">     161 </span>            :                                         orte_rml_send_t *msg);
<span class="lineNum">     162 </span>            : typedef int (*mca_oob_ud_recv_cancel_fn_t)(orte_process_name_t *name, int tag);
<span class="lineNum">     163 </span>            : 
<span class="lineNum">     164 </span>            : typedef struct {
<span class="lineNum">     165 </span>            :     mca_oob_ud_module_init_fn_t                init;
<span class="lineNum">     166 </span>            :     mca_oob_ud_module_fini_fn_t                finalize;
<span class="lineNum">     167 </span>            :     mca_oob_ud_set_addr_fn_t                   set_addr;
<span class="lineNum">     168 </span>            :     mca_oob_ud_ping_fn_t                       ping;
<span class="lineNum">     169 </span>            :     mca_oob_ud_send_nb_fn_t                    send_nb;
<span class="lineNum">     170 </span>            : } mca_oob_ud_module_api_t;
<span class="lineNum">     171 </span>            : 
<span class="lineNum">     172 </span>            : typedef struct {
<span class="lineNum">     173 </span>            :     mca_oob_ud_module_api_t    api;
<span class="lineNum">     174 </span>            :     opal_event_base_t          *ev_base;      /* event base for the module progress thread */
<span class="lineNum">     175 </span>            :     bool                       ev_active;
<span class="lineNum">     176 </span>            :     opal_thread_t              progress_thread;
<span class="lineNum">     177 </span>            :     opal_proc_table_t          peers;         // connection addresses for peers
<span class="lineNum">     178 </span>            : } mca_oob_ud_module_t;
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span>            : ORTE_MODULE_DECLSPEC extern mca_oob_ud_module_t mca_oob_ud_module;
<span class="lineNum">     181 </span>            : 
<span class="lineNum">     182 </span>            : int mca_oob_ud_process_ping(int fd, short args, void *cbdata);
<span class="lineNum">     183 </span>            : int mca_oob_ud_process_send_nb(int fd, short args, void *cbdata);
<span class="lineNum">     184 </span>            : int mca_oob_ud_send_try (mca_oob_ud_req_t *send_req);
<span class="lineNum">     185 </span>            : int mca_oob_ud_send_complete (mca_oob_ud_req_t *send_req, int rc);
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span>            : /* recv */
<span class="lineNum">     188 </span>            : int mca_oob_ud_recv_nb(orte_process_name_t* peer,
<span class="lineNum">     189 </span>            :                        orte_rml_send_t *msg);
<span class="lineNum">     190 </span>            : int mca_oob_ud_recv_cancel(orte_process_name_t* name, int tag);
<span class="lineNum">     191 </span>            : 
<span class="lineNum">     192 </span>            : int mca_oob_ud_recv_complete (mca_oob_ud_req_t *recv_req);
<span class="lineNum">     193 </span>            : int mca_oob_ud_recv_try (mca_oob_ud_req_t *recv_req);
<span class="lineNum">     194 </span>            : int mca_oob_ud_recv_match_send (mca_oob_ud_port_t *port, mca_oob_ud_peer_t *peer,
<span class="lineNum">     195 </span>            :                                 mca_oob_ud_msg_hdr_t *msg_hdr, mca_oob_ud_req_t **reqp);
<span class="lineNum">     196 </span>            : int mca_oob_ud_get_recv_req (const orte_process_name_t name, const int tag, mca_oob_ud_req_t **reqp, bool iovec_used);
<span class="lineNum">     197 </span>            : 
<span class="lineNum">     198 </span>            : int mca_oob_ud_register_iov (struct iovec *iov, int count, struct ibv_mr **ib_mr,
<span class="lineNum">     199 </span>            :                              struct ibv_pd *ib_pd, unsigned int mtu, int *sge_countp,
<span class="lineNum">     200 </span>            :                              int *wr_countp, int *data_lenp);
<span class="lineNum">     201 </span>            : int mca_oob_ud_register_buf (char *buf, int size, struct ibv_mr **ib_mr_buf,
<span class="lineNum">     202 </span>            :                              struct ibv_pd *ib_pd, unsigned int mtu, int *sge_countp, int *wr_countp);
<span class="lineNum">     203 </span>            : void mca_oob_ud_event_queue_completed (mca_oob_ud_req_t *req);
<span class="lineNum">     204 </span>            : 
<span class="lineNum">     205 </span>            : END_C_DECLS
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            : #endif
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
