<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - master-ibm-intel-check - ompi/mca/io/romio314/romio/adio/common/ad_aggregate_new.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">ompi/mca/io/romio314/romio/adio/common</a> - ad_aggregate_new.c<span style="font-size: 80%;"> (source / <a href="ad_aggregate_new.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">master-ibm-intel-check</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">103</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2015-08-03 17:10:23</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">8</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- Mode: C; c-basic-offset:4 ; indent-tabs-mode:nil ; -*- */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  *   Copyright (C) 2008 University of Chicago.
<span class="lineNum">       4 </span>            :  *   See COPYRIGHT notice in top-level directory.
<span class="lineNum">       5 </span>            :  */
<span class="lineNum">       6 </span>            : 
<span class="lineNum">       7 </span>            : #include &quot;adio.h&quot;
<span class="lineNum">       8 </span>            : #include &quot;adio_extern.h&quot;
<span class="lineNum">       9 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">      10 </span>            : #include &quot;mpe.h&quot;
<span class="lineNum">      11 </span>            : #endif
<span class="lineNum">      12 </span>            : #include &lt;assert.h&gt;
<span class="lineNum">      13 </span>            : /* #define DEBUG */
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : void ADIOI_Calc_file_realms_user_size (ADIO_File fd, int fr_size,
<span class="lineNum">      16 </span>            :                                        int nprocs_for_coll,
<span class="lineNum">      17 </span>            :                                        ADIO_Offset *file_realm_st_offs,
<span class="lineNum">      18 </span>            :                                        MPI_Datatype *file_realm_types);
<span class="lineNum">      19 </span>            : void ADIOI_Calc_file_realms_aar (ADIO_File fd, int nprocs_for_coll,
<span class="lineNum">      20 </span>            :                                  int pfr_enabled,
<span class="lineNum">      21 </span>            :                                  ADIO_Offset min_st_offset,
<span class="lineNum">      22 </span>            :                                  ADIO_Offset max_end_offset,
<span class="lineNum">      23 </span>            :                                  ADIO_Offset *file_realm_st_offs,
<span class="lineNum">      24 </span>            :                                  MPI_Datatype *file_realm_types);
<span class="lineNum">      25 </span>            : void ADIOI_Calc_file_realms_fsize (ADIO_File fd,
<span class="lineNum">      26 </span>            :                                    int nprocs_for_coll,
<span class="lineNum">      27 </span>            :                                    ADIO_Offset max_end_offset,
<span class="lineNum">      28 </span>            :                                    ADIO_Offset *file_realm_st_offs,
<span class="lineNum">      29 </span>            :                                    MPI_Datatype *file_realm_types);
<span class="lineNum">      30 </span>            : void ADIOI_Create_fr_simpletype (int size, int nprocs_for_coll,
<span class="lineNum">      31 </span>            :                               MPI_Datatype *simpletype);
<span class="lineNum">      32 </span>            : static void align_fr (int fr_size, ADIO_Offset fr_off, int alignment,
<span class="lineNum">      33 </span>            :                int *aligned_fr_size, ADIO_Offset *aligned_fr_off);
<span class="lineNum">      34 </span>            : void ADIOI_Verify_fr (int nprocs_for_coll, ADIO_Offset *file_realm_st_offs,
<a name="35"><span class="lineNum">      35 </span>            :                       MPI_Datatype *file_realm_types);</a>
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span><span class="lineNoCov">          0 : void ADIOI_Calc_file_realms (ADIO_File fd, ADIO_Offset min_st_offset,</span>
<span class="lineNum">      38 </span>            :                              ADIO_Offset max_end_offset)
<span class="lineNum">      39 </span>            : {
<span class="lineNum">      40 </span>            :     int nprocs_for_coll;
<span class="lineNum">      41 </span>            :     int file_realm_calc_type;
<span class="lineNum">      42 </span>            : 
<span class="lineNum">      43 </span><span class="lineNoCov">          0 :     MPI_Datatype *file_realm_types = NULL;</span>
<span class="lineNum">      44 </span><span class="lineNoCov">          0 :     ADIO_Offset *file_realm_st_offs = NULL;</span>
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">      47 </span>            :     MPE_Log_event (5004, 0, NULL);
<span class="lineNum">      48 </span>            : #endif
<span class="lineNum">      49 </span>            : #ifdef DEBUG
<span class="lineNum">      50 </span>            :     printf (&quot;ADIOI_Calc_file_realms\n&quot;);
<span class="lineNum">      51 </span>            : #endif
<span class="lineNum">      52 </span>            : 
<span class="lineNum">      53 </span><span class="lineNoCov">          0 :     nprocs_for_coll = fd-&gt;hints-&gt;cb_nodes;</span>
<span class="lineNum">      54 </span><span class="lineNoCov">          0 :     file_realm_calc_type = fd-&gt;hints-&gt;cb_fr_type;</span>
<span class="lineNum">      55 </span>            : 
<span class="lineNum">      56 </span>            :     /* If PFRs are disabled we know these pointers are not allocated */
<span class="lineNum">      57 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_pfr != ADIOI_HINT_ENABLE) {</span>
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :         fd-&gt;file_realm_st_offs = NULL;</span>
<span class="lineNum">      59 </span><span class="lineNoCov">          0 :         fd-&gt;file_realm_types = NULL;</span>
<span class="lineNum">      60 </span>            :     }
<span class="lineNum">      61 </span>            : 
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :     if (nprocs_for_coll == 1) {</span>
<span class="lineNum">      63 </span>            :         /* if there's only one aggregator, we can reset the file
<span class="lineNum">      64 </span>            :          * realms every single time */
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :         if (fd-&gt;file_realm_st_offs == NULL)</span>
<span class="lineNum">      66 </span>            :         {
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :             file_realm_st_offs = (ADIO_Offset *)</span>
<span class="lineNum">      68 </span>            :                 ADIOI_Malloc (sizeof(ADIO_Offset));
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :             file_realm_types   = (MPI_Datatype *)</span>
<span class="lineNum">      70 </span>            :                 ADIOI_Malloc (sizeof(MPI_Datatype));
<span class="lineNum">      71 </span>            :         }
<span class="lineNum">      72 </span>            :         else
<span class="lineNum">      73 </span>            :         {
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :             file_realm_st_offs = fd-&gt;file_realm_st_offs;</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :             file_realm_types   = fd-&gt;file_realm_types;</span>
<span class="lineNum">      76 </span>            :         }
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :         *file_realm_st_offs = min_st_offset;</span>
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :         MPI_Type_contiguous ((max_end_offset - min_st_offset + 1), MPI_BYTE,</span>
<span class="lineNum">      79 </span>            :                              file_realm_types);
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :         MPI_Type_commit (file_realm_types);</span>
<span class="lineNum">      81 </span><span class="lineNoCov">          0 :         ADIOI_Add_contig_flattened (*file_realm_types);</span>
<span class="lineNum">      82 </span>            :     }
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :     else if (fd-&gt;file_realm_st_offs == NULL) {</span>
<span class="lineNum">      84 </span><span class="lineNoCov">          0 :         file_realm_st_offs = (ADIO_Offset *)</span>
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :             ADIOI_Malloc (nprocs_for_coll * sizeof(ADIO_Offset));</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :         file_realm_types   = (MPI_Datatype *)</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :             ADIOI_Malloc (nprocs_for_coll * sizeof(MPI_Datatype));</span>
<span class="lineNum">      88 </span>            : 
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :         if (file_realm_calc_type == ADIOI_FR_AAR) {</span>
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :             ADIOI_Calc_file_realms_aar (fd, nprocs_for_coll,</span>
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :                                         fd-&gt;hints-&gt;cb_pfr,</span>
<span class="lineNum">      92 </span>            :                                         min_st_offset, max_end_offset,
<span class="lineNum">      93 </span>            :                                         file_realm_st_offs, file_realm_types);
<span class="lineNum">      94 </span>            :             /* flatten file realm datatype for future use - only one
<span class="lineNum">      95 </span>            :              * because all are the same*/
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :             ADIOI_Flatten_datatype (file_realm_types[0]);</span>
<span class="lineNum">      97 </span>            :         }
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :         else if (file_realm_calc_type == ADIOI_FR_FSZ) {</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :             ADIOI_Calc_file_realms_fsize (fd, nprocs_for_coll, max_end_offset,</span>
<span class="lineNum">     100 </span>            :                                           file_realm_st_offs,
<span class="lineNum">     101 </span>            :                                           file_realm_types);
<span class="lineNum">     102 </span>            :             /* flatten file realm datatype for future use - only one
<span class="lineNum">     103 </span>            :              * because all are the same*/
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :             ADIOI_Flatten_datatype (file_realm_types[0]);</span>
<span class="lineNum">     105 </span>            :         }
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :         else if (file_realm_calc_type == ADIOI_FR_USR_REALMS) {</span>
<span class="lineNum">     107 </span>            :             /* copy user provided realm datatypes and realm offsets in
<span class="lineNum">     108 </span>            :              * hints to file descriptor. may also want to verify that
<span class="lineNum">     109 </span>            :              * the provided file realms are covering (for pfr at
<span class="lineNum">     110 </span>            :              * least) and non-overlapping */
<span class="lineNum">     111 </span>            :         }
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :         else if (file_realm_calc_type &gt; 0) {</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :             ADIOI_Calc_file_realms_user_size (fd, file_realm_calc_type,</span>
<span class="lineNum">     114 </span>            :                                               nprocs_for_coll,
<span class="lineNum">     115 </span>            :                                               file_realm_st_offs,
<span class="lineNum">     116 </span>            :                                               file_realm_types);
<span class="lineNum">     117 </span>            :             /* flatten file realm datatype for future use - only one
<span class="lineNum">     118 </span>            :              * because all are the same */
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :             ADIOI_Flatten_datatype (file_realm_types[0]);</span>
<span class="lineNum">     120 </span>            :         }
<span class="lineNum">     121 </span>            :     }
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     fd-&gt;file_realm_st_offs = file_realm_st_offs;</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :     fd-&gt;file_realm_types   = file_realm_types;</span>
<span class="lineNum">     124 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">     125 </span>            :     MPE_Log_event (5005, 0, NULL);
<span class="lineNum">     126 </span>            : #endif
<a name="127"><span class="lineNum">     127 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     128 </span>            : 
<span class="lineNum">     129 </span><span class="lineNoCov">          0 : void ADIOI_Calc_file_realms_user_size (ADIO_File fd, int fr_size,</span>
<span class="lineNum">     130 </span>            :                                        int nprocs_for_coll,
<span class="lineNum">     131 </span>            :                                        ADIO_Offset *file_realm_st_offs,
<span class="lineNum">     132 </span>            :                                        MPI_Datatype *file_realm_types)
<span class="lineNum">     133 </span>            : {
<span class="lineNum">     134 </span>            :     int i;
<span class="lineNum">     135 </span>            :     int aligned_fr_size;
<span class="lineNum">     136 </span>            :     ADIO_Offset aligned_fr_off;
<span class="lineNum">     137 </span>            :     MPI_Datatype simpletype;
<span class="lineNum">     138 </span>            : 
<span class="lineNum">     139 </span><span class="lineNoCov">          0 :     align_fr(fr_size, 0, fd-&gt;hints-&gt;cb_fr_alignment, &amp;aligned_fr_size,</span>
<span class="lineNum">     140 </span>            :              &amp;aligned_fr_off);
<span class="lineNum">     141 </span><span class="lineNoCov">          0 :     fr_size = aligned_fr_size;</span>
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :     ADIOI_Create_fr_simpletype (fr_size, nprocs_for_coll, &amp;simpletype);</span>
<span class="lineNum">     143 </span>            : 
<span class="lineNum">     144 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_pfr == ADIOI_HINT_ENABLE)</span>
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :         file_realm_st_offs[0] = 0;</span>
<span class="lineNum">     146 </span>            :     else
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :         file_realm_st_offs[0] = aligned_fr_off;</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :     file_realm_types[0]   = simpletype;</span>
<span class="lineNum">     149 </span>            : #ifdef DEBUG
<span class="lineNum">     150 </span>            :     printf (&quot;file_realm[0] = (%lld, %d)\n&quot;, file_realm_st_offs[0],
<span class="lineNum">     151 </span>            :             fr_size);
<span class="lineNum">     152 </span>            : #endif
<span class="lineNum">     153 </span>            : 
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :     for (i=1; i &lt; nprocs_for_coll; i++)</span>
<span class="lineNum">     155 </span>            :     {
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :         file_realm_st_offs[i] = file_realm_st_offs[i-1] + fr_size;</span>
<span class="lineNum">     157 </span><span class="lineNoCov">          0 :         file_realm_types[i]   = simpletype;</span>
<span class="lineNum">     158 </span>            : #ifdef DEBUG
<span class="lineNum">     159 </span>            :         printf (&quot;file_realm[%d] = (%lld, %d)\n&quot;, i, file_realm_st_offs[i],
<span class="lineNum">     160 </span>            :                 aligned_fr_size);
<span class="lineNum">     161 </span>            : #endif
<span class="lineNum">     162 </span>            :     }
<span class="lineNum">     163 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     164 </span>            : 
<a name="165"><span class="lineNum">     165 </span>            : /* takes an extra romio_cb_pfr param to decide whether file realms</a>
<span class="lineNum">     166 </span>            :  * should start at byte 0 of the file*/
<span class="lineNum">     167 </span><span class="lineNoCov">          0 : void ADIOI_Calc_file_realms_aar (ADIO_File fd, int nprocs_for_coll, int cb_pfr,</span>
<span class="lineNum">     168 </span>            :                                  ADIO_Offset min_st_offset,
<span class="lineNum">     169 </span>            :                                  ADIO_Offset max_end_offset,
<span class="lineNum">     170 </span>            :                                  ADIO_Offset *file_realm_st_offs,
<span class="lineNum">     171 </span>            :                                  MPI_Datatype *file_realm_types)
<span class="lineNum">     172 </span>            : {
<span class="lineNum">     173 </span>            :     int fr_size, aligned_fr_size, i;
<span class="lineNum">     174 </span>            :     MPI_Datatype simpletype;
<span class="lineNum">     175 </span>            :     ADIO_Offset aligned_start_off;
<span class="lineNum">     176 </span>            :     char value[9];
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     fr_size = (max_end_offset - min_st_offset + nprocs_for_coll) /</span>
<span class="lineNum">     179 </span>            :         nprocs_for_coll;
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     align_fr(fr_size, min_st_offset, fd-&gt;hints-&gt;cb_fr_alignment,</span>
<span class="lineNum">     181 </span>            :              &amp;aligned_fr_size, &amp;aligned_start_off);
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :     fr_size = aligned_fr_size;</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :     ADIOI_Create_fr_simpletype (fr_size, nprocs_for_coll, &amp;simpletype);</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :     if (cb_pfr == ADIOI_HINT_ENABLE)</span>
<span class="lineNum">     185 </span><span class="lineNoCov">          0 :         file_realm_st_offs[0] = 0;</span>
<span class="lineNum">     186 </span>            :     else
<span class="lineNum">     187 </span><span class="lineNoCov">          0 :         file_realm_st_offs[0] = aligned_start_off;</span>
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :     file_realm_types[0]   = simpletype;</span>
<span class="lineNum">     189 </span>            : 
<span class="lineNum">     190 </span>            : #ifdef DEBUG
<span class="lineNum">     191 </span>            :     printf (&quot;file_realm[0] = (%lld, %d)\n&quot;, file_realm_st_offs[0],
<span class="lineNum">     192 </span>            :             fr_size);
<span class="lineNum">     193 </span>            : #endif
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :     for (i=1; i &lt; nprocs_for_coll; i++)</span>
<span class="lineNum">     195 </span>            :     {
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :         file_realm_st_offs[i] = file_realm_st_offs[i-1] + fr_size;</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :         file_realm_types[i]   = simpletype;</span>
<span class="lineNum">     198 </span>            : #ifdef DEBUG
<span class="lineNum">     199 </span>            :         printf (&quot;file_realm[%d] = (%lld, %d)\n&quot;, i, file_realm_st_offs[i],
<span class="lineNum">     200 </span>            :                 fr_size);
<span class="lineNum">     201 </span>            : #endif
<span class="lineNum">     202 </span>            :     }
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_pfr == ADIOI_HINT_ENABLE) {</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :         sprintf (value, &quot;%d&quot;, fr_size);</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :         ADIOI_Info_set (fd-&gt;info, &quot;romio_cb_fr_type&quot;, value);</span>
<span class="lineNum">     206 </span>            :     }
<a name="207"><span class="lineNum">     207 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     208 </span>            : 
<span class="lineNum">     209 </span><span class="lineNoCov">          0 : void ADIOI_Calc_file_realms_fsize (ADIO_File fd, int nprocs_for_coll,</span>
<span class="lineNum">     210 </span>            :                                    ADIO_Offset max_end_offset,
<span class="lineNum">     211 </span>            :                                    ADIO_Offset *file_realm_st_offs,
<span class="lineNum">     212 </span>            :                                    MPI_Datatype *file_realm_types)
<span class="lineNum">     213 </span>            : {
<span class="lineNum">     214 </span>            :     int fr_size, aligned_fr_size, error_code, i;
<span class="lineNum">     215 </span>            :     int fsize;
<span class="lineNum">     216 </span>            :     ADIO_Offset aligned_fr_off;
<span class="lineNum">     217 </span>            :     ADIO_Fcntl_t fcntl_struct;
<span class="lineNum">     218 </span>            :     MPI_Datatype simpletype;
<span class="lineNum">     219 </span>            : 
<span class="lineNum">     220 </span><span class="lineNoCov">          0 :     ADIO_Fcntl (fd, ADIO_FCNTL_GET_FSIZE, &amp;fcntl_struct, &amp;error_code);</span>
<span class="lineNum">     221 </span>            : 
<span class="lineNum">     222 </span>            :     /* use impending file size since a write call may lengthen the file */
<span class="lineNum">     223 </span><span class="lineNoCov">          0 :     fsize = ADIOI_MAX (fcntl_struct.fsize, max_end_offset+1);</span>
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :     fr_size = (fsize + nprocs_for_coll - 1) / nprocs_for_coll;</span>
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     align_fr(fr_size, 0, fd-&gt;hints-&gt;cb_fr_alignment,</span>
<span class="lineNum">     226 </span>            :              &amp;aligned_fr_size, &amp;aligned_fr_off);
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :     ADIOI_Create_fr_simpletype (fr_size, nprocs_for_coll, &amp;simpletype);</span>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :     for (i=0; i &lt; nprocs_for_coll; i++)</span>
<span class="lineNum">     230 </span>            :     {
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         file_realm_st_offs[i] = fr_size * i;</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :         file_realm_types[i]   = simpletype;</span>
<span class="lineNum">     233 </span>            :     }
<span class="lineNum">     234 </span><span class="lineNoCov">          0 : }</span>
<a name="235"><span class="lineNum">     235 </span>            : </a>
<span class="lineNum">     236 </span>            : /* creates a datatype with an empty trailing edge */
<span class="lineNum">     237 </span><span class="lineNoCov">          0 : void ADIOI_Create_fr_simpletype (int size, int nprocs_for_coll,</span>
<span class="lineNum">     238 </span>            :                               MPI_Datatype *simpletype)
<span class="lineNum">     239 </span>            : {
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :     int count=2, blocklens[2];</span>
<span class="lineNum">     241 </span>            :     MPI_Aint indices[2];
<span class="lineNum">     242 </span>            :     MPI_Datatype old_types[2];
<span class="lineNum">     243 </span>            : 
<span class="lineNum">     244 </span><span class="lineNoCov">          0 :     blocklens[0] = size;</span>
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :     blocklens[1] = 1;</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :     indices[0]   = 0;</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :     indices[1]   = size*nprocs_for_coll;</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :     old_types[0] = MPI_BYTE;</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :     old_types[1] = MPI_UB;</span>
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :     MPI_Type_struct (count, blocklens, indices, old_types, simpletype);</span>
<span class="lineNum">     252 </span>            : 
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :     MPI_Type_commit (simpletype);</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 : }</span>
<a name="255"><span class="lineNum">     255 </span>            : </a>
<span class="lineNum">     256 </span>            : /* Verify that file realms are covering (PFRs) and non-overlapping */
<span class="lineNum">     257 </span><span class="lineNoCov">          0 : void ADIOI_Verify_fr (int nprocs_for_coll, ADIO_Offset *file_realm_st_offs,</span>
<span class="lineNum">     258 </span>            :                       MPI_Datatype *file_realm_types)
<span class="lineNum">     259 </span>            : {
<a name="260"><span class="lineNum">     260 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     261 </span>            : 
<span class="lineNum">     262 </span><span class="lineNoCov">          0 : int ADIOI_Agg_idx (int rank, ADIO_File fd) {</span>
<span class="lineNum">     263 </span>            :     int i, cb_nodes, *ranklist;
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :     cb_nodes = fd-&gt;hints-&gt;cb_nodes;</span>
<span class="lineNum">     265 </span><span class="lineNoCov">          0 :     ranklist = fd-&gt;hints-&gt;ranklist;</span>
<span class="lineNum">     266 </span>            : 
<span class="lineNum">     267 </span><span class="lineNoCov">          0 :     for (i=0; i&lt;cb_nodes; i++) {</span>
<span class="lineNum">     268 </span><span class="lineNoCov">          0 :         if (ranklist[i])</span>
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :             return i;</span>
<span class="lineNum">     270 </span>            :     }
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :     return -1;</span>
<a name="272"><span class="lineNum">     272 </span>            : }</a>
<span class="lineNum">     273 </span>            : 
<span class="lineNum">     274 </span><span class="lineNoCov">          0 : static void align_fr (int fr_size, ADIO_Offset fr_off, int alignment,</span>
<span class="lineNum">     275 </span>            :                int *aligned_fr_size, ADIO_Offset *aligned_fr_off) {
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :     *aligned_fr_off = fr_off - (fr_off % alignment);</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 :     *aligned_fr_size = ((fr_off + fr_size) / alignment) * alignment -</span>
<span class="lineNum">     278 </span><span class="lineNoCov">          0 :         *aligned_fr_off;</span>
<span class="lineNum">     279 </span><span class="lineNoCov">          0 :     if ((fr_off + fr_size) % alignment)</span>
<span class="lineNum">     280 </span><span class="lineNoCov">          0 :         *aligned_fr_size += alignment;</span>
<span class="lineNum">     281 </span>            : 
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :     assert(!((*aligned_fr_off % alignment) ||</span>
<span class="lineNum">     283 </span>            :              (*aligned_fr_size % alignment)));
<span class="lineNum">     284 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
