<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - master-ibm-intel-check - ompi/mca/io/romio314/romio/adio/common/ad_coll_exch_new.c</title>
  <link rel="stylesheet" type="text/css" href="../../../../../../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../../../../../../index.html">top level</a> - <a href="index.html">ompi/mca/io/romio314/romio/adio/common</a> - ad_coll_exch_new.c<span style="font-size: 80%;"> (source / <a href="ad_coll_exch_new.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">master-ibm-intel-check</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">229</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2015-07-31 16:35:34</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">3</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /* -*- Mode: C; c-basic-offset:4 ; indent-tabs-mode:nil ; -*- */</a>
<span class="lineNum">       2 </span>            : /*
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *   Copyright (C) 1997 University of Chicago.
<span class="lineNum">       5 </span>            :  *   See COPYRIGHT notice in top-level directory.
<span class="lineNum">       6 </span>            :  */
<span class="lineNum">       7 </span>            : 
<span class="lineNum">       8 </span>            : #include &lt;assert.h&gt;
<span class="lineNum">       9 </span>            : #include &quot;adio.h&quot;
<span class="lineNum">      10 </span>            : #include &quot;adio_extern.h&quot;
<span class="lineNum">      11 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">      12 </span>            : #include &quot;mpe.h&quot;
<span class="lineNum">      13 </span>            : #endif
<span class="lineNum">      14 </span>            : 
<span class="lineNum">      15 </span>            : /*
<span class="lineNum">      16 </span>            : #define DEBUG
<span class="lineNum">      17 </span>            : #define DEBUG2
<span class="lineNum">      18 </span>            : */
<span class="lineNum">      19 </span>            : 
<span class="lineNum">      20 </span>            : #define COUNT_EXCH          0
<span class="lineNum">      21 </span>            : #define BLOCK_LENS          1
<span class="lineNum">      22 </span>            : #define INDICES             2
<span class="lineNum">      23 </span>            : #define FPIND_DISP_OFF_SZ   3
<span class="lineNum">      24 </span>            : 
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : typedef struct {
<span class="lineNum">      27 </span>            :     int count;
<span class="lineNum">      28 </span>            :     ADIO_Offset fp_ind;
<span class="lineNum">      29 </span>            :     ADIO_Offset disp;
<span class="lineNum">      30 </span>            :     ADIO_Offset byte_off;
<span class="lineNum">      31 </span>            :     ADIO_Offset sz;
<span class="lineNum">      32 </span>            :     ADIO_Offset ext;
<span class="lineNum">      33 </span>            :     ADIO_Offset type_sz;
<span class="lineNum">      34 </span>            : } amount_and_extra_data_t;
<a name="35"><span class="lineNum">      35 </span>            : </a>
<span class="lineNum">      36 </span>            : /* Debugging function to print out an ADIOI_Flatlist_node. */
<span class="lineNum">      37 </span><span class="lineNoCov">          0 : void ADIOI_Print_flatlist_node(ADIOI_Flatlist_node *flatlist_node_p)</span>
<span class="lineNum">      38 </span>            : {
<span class="lineNum">      39 </span>            :     int i;
<span class="lineNum">      40 </span><span class="lineNoCov">          0 :     if (flatlist_node_p == NULL)</span>
<span class="lineNum">      41 </span>            :     {
<span class="lineNum">      42 </span><span class="lineNoCov">          0 :         fprintf(stderr, &quot;print flatlist node of NULL ptr\n&quot;);</span>
<span class="lineNum">      43 </span><span class="lineNoCov">          0 :         return;</span>
<span class="lineNum">      44 </span>            :     }
<span class="lineNum">      45 </span><span class="lineNoCov">          0 :     fprintf(stderr, &quot;print flatlist node count = %d (idx,blocklen)\n&quot;,</span>
<span class="lineNum">      46 </span><span class="lineNoCov">          0 :             (int)flatlist_node_p-&gt;count);</span>
<span class="lineNum">      47 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; flatlist_node_p-&gt;count; i++)</span>
<span class="lineNum">      48 </span>            :     {
<span class="lineNum">      49 </span><span class="lineNoCov">          0 :         if (i % 5 == 0 &amp;&amp; i != 0)</span>
<span class="lineNum">      50 </span>            :         {
<span class="lineNum">      51 </span><span class="lineNoCov">          0 :             fprintf(stderr, &quot;%d=(%lld,%lld)\n&quot;, i, (long long)flatlist_node_p-&gt;indices[i],</span>
<span class="lineNum">      52 </span><span class="lineNoCov">          0 :                     (long long)flatlist_node_p-&gt;blocklens[i]);</span>
<span class="lineNum">      53 </span>            :         }
<span class="lineNum">      54 </span>            :         else
<span class="lineNum">      55 </span><span class="lineNoCov">          0 :             fprintf(stderr, &quot;%d=(%lld,%lld) &quot;, i, (long long)flatlist_node_p-&gt;indices[i],</span>
<span class="lineNum">      56 </span><span class="lineNoCov">          0 :                     (long long)flatlist_node_p-&gt;blocklens[i]);</span>
<span class="lineNum">      57 </span>            :     }
<span class="lineNum">      58 </span><span class="lineNoCov">          0 :     fprintf(stderr, &quot;\n&quot;);</span>
<span class="lineNum">      59 </span>            : }
<span class="lineNum">      60 </span>            : 
<a name="61"><span class="lineNum">      61 </span>            : /* Since ADIOI_Flatten_datatype won't add a contig datatype to the</a>
<span class="lineNum">      62 </span>            :  * ADIOI_Flatlist, we can force it to do so with this function. */
<span class="lineNum">      63 </span><span class="lineNoCov">          0 : ADIOI_Flatlist_node * ADIOI_Add_contig_flattened(MPI_Datatype contig_type)</span>
<span class="lineNum">      64 </span>            : {
<span class="lineNum">      65 </span><span class="lineNoCov">          0 :     MPI_Count contig_type_sz = -1;</span>
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :     ADIOI_Flatlist_node *flat_node_p = ADIOI_Flatlist;</span>
<span class="lineNum">      67 </span>            : 
<span class="lineNum">      68 </span>            :     /* Add contig type to the end of the list if it doesn't already
<span class="lineNum">      69 </span>            :      * exist. */
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :     while (flat_node_p-&gt;next)</span>
<span class="lineNum">      71 </span>            :     {
<span class="lineNum">      72 </span><span class="lineNoCov">          0 :         if (flat_node_p-&gt;type == contig_type)</span>
<span class="lineNum">      73 </span><span class="lineNoCov">          0 :             return flat_node_p;</span>
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :         flat_node_p = flat_node_p-&gt;next;</span>
<span class="lineNum">      75 </span>            :     }
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :     if (flat_node_p-&gt;type == contig_type)</span>
<span class="lineNum">      77 </span><span class="lineNoCov">          0 :         return flat_node_p;</span>
<span class="lineNum">      78 </span>            : 
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :     MPI_Type_size_x(contig_type, &amp;contig_type_sz);</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :     if ((flat_node_p-&gt;next = (ADIOI_Flatlist_node *) ADIOI_Malloc</span>
<span class="lineNum">      81 </span>            :          (sizeof(ADIOI_Flatlist_node))) == NULL)
<span class="lineNum">      82 </span>            :     {
<span class="lineNum">      83 </span><span class="lineNoCov">          0 :         fprintf(stderr, &quot;ADIOI_Add_contig_flattened: malloc next failed\n&quot;);</span>
<span class="lineNum">      84 </span>            :     }
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :     flat_node_p = flat_node_p-&gt;next;</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :     flat_node_p-&gt;type = contig_type;</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :     if ((flat_node_p-&gt;blocklens = (ADIO_Offset *) ADIOI_Malloc(sizeof(ADIO_Offset))) == NULL)</span>
<span class="lineNum">      88 </span>            :     {
<span class="lineNum">      89 </span><span class="lineNoCov">          0 :         fprintf(stderr, &quot;ADIOI_Flatlist_node: malloc blocklens failed\n&quot;);</span>
<span class="lineNum">      90 </span>            :     }
<span class="lineNum">      91 </span><span class="lineNoCov">          0 :     if ((flat_node_p-&gt;indices = (ADIO_Offset *)</span>
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :          ADIOI_Malloc(sizeof(ADIO_Offset))) == NULL)</span>
<span class="lineNum">      93 </span>            :     {
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :         fprintf(stderr, &quot;ADIOI_Flatlist_node: malloc indices failed\n&quot;);</span>
<span class="lineNum">      95 </span>            :     }
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :     flat_node_p-&gt;blocklens[0] = contig_type_sz;</span>
<span class="lineNum">      97 </span><span class="lineNoCov">          0 :     flat_node_p-&gt;indices[0] = 0;</span>
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :     flat_node_p-&gt;count = 1;</span>
<span class="lineNum">      99 </span><span class="lineNoCov">          0 :     flat_node_p-&gt;next = NULL;</span>
<span class="lineNum">     100 </span><span class="lineNoCov">          0 :     return flat_node_p;</span>
<span class="lineNum">     101 </span>            : }
<span class="lineNum">     102 </span>            : 
<span class="lineNum">     103 </span>            : /* ADIOI_Exchange_file_views - Sends all the aggregators the file
<span class="lineNum">     104 </span>            :  * views and file view states of the clients.  It fills in the
<span class="lineNum">     105 </span>            :  * client_file_view_state_arr for the aggregators and the
<span class="lineNum">     106 </span>            :  * my_mem_view_state for the client.  It also initializes the
<a name="107"><span class="lineNum">     107 </span>            :  * agg_file_view_state for all clients, which is the view for each</a>
<span class="lineNum">     108 </span>            :  * aggregator of a client's filetype. */
<span class="lineNum">     109 </span><span class="lineNoCov">          0 : void ADIOI_Exch_file_views(int myrank, int nprocs, int file_ptr_type,</span>
<span class="lineNum">     110 </span>            :                            ADIO_File fd, int count,
<span class="lineNum">     111 </span>            :                            MPI_Datatype datatype, ADIO_Offset off,
<span class="lineNum">     112 </span>            :                            view_state *my_mem_view_state_arr,
<span class="lineNum">     113 </span>            :                            view_state *agg_file_view_state_arr,
<span class="lineNum">     114 </span>            :                            view_state *client_file_view_state_arr)
<span class="lineNum">     115 </span>            : {
<span class="lineNum">     116 </span>            :     /* Convert my own fileview to an ADIOI_Flattened type and a
<span class="lineNum">     117 </span>            :      * disp. MPI_Alltoall the count of ADIOI_Flatlist nodes.
<span class="lineNum">     118 </span>            :      * MPI_Isend/Irecv the block_lens, indices of ADIOI_Flatlist node
<span class="lineNum">     119 </span>            :      * to/from each of the aggregators with the rest of the file view
<span class="lineNum">     120 </span>            :      * state. */
<span class="lineNum">     121 </span>            : 
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :     int i = -1, j = -1;</span>
<span class="lineNum">     123 </span><span class="lineNoCov">          0 :     amount_and_extra_data_t *send_count_arr = NULL;</span>
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :     amount_and_extra_data_t *recv_count_arr = NULL;</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :     int send_req_arr_sz = 0;</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :     int recv_req_arr_sz = 0;</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :     MPI_Request *send_req_arr = NULL, *recv_req_arr = NULL;</span>
<span class="lineNum">     128 </span><span class="lineNoCov">          0 :     MPI_Status *statuses = NULL;</span>
<span class="lineNum">     129 </span>            :     ADIO_Offset disp_off_sz_ext_typesz[6];
<span class="lineNum">     130 </span>            :     MPI_Aint memtype_extent, filetype_extent;
<span class="lineNum">     131 </span><span class="lineNoCov">          0 :     int ret = -1;</span>
<span class="lineNum">     132 </span>            : 
<span class="lineNum">     133 </span>            :     /* parameters for datatypes */
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :     ADIOI_Flatlist_node *flat_mem_p = NULL, *flat_file_p = NULL;</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :     MPI_Count memtype_sz = -1;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :     int memtype_is_contig = -1;</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :     ADIO_Offset filetype_sz = -1;</span>
<span class="lineNum">     138 </span>            : 
<span class="lineNum">     139 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">     140 </span>            :     MPE_Log_event (5014, 0, NULL);
<span class="lineNum">     141 </span>            : #endif
<span class="lineNum">     142 </span>            :     /* The memtype will be freed after the call.  The filetype will be
<span class="lineNum">     143 </span>            :      * freed in the close and should have been flattened in the file
<span class="lineNum">     144 </span>            :      * view. */
<span class="lineNum">     145 </span><span class="lineNoCov">          0 :     MPI_Type_size_x(datatype, &amp;memtype_sz);</span>
<span class="lineNum">     146 </span><span class="lineNoCov">          0 :     MPI_Type_extent(datatype, &amp;memtype_extent);</span>
<span class="lineNum">     147 </span><span class="lineNoCov">          0 :     if (memtype_sz == memtype_extent) {</span>
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :         memtype_is_contig = 1;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :         flat_mem_p = ADIOI_Add_contig_flattened(datatype);</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :         flat_mem_p-&gt;blocklens[0] = memtype_sz*count;</span>
<span class="lineNum">     151 </span>            :     }
<span class="lineNum">     152 </span>            :     else {
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :         ADIOI_Flatten_datatype(datatype);</span>
<span class="lineNum">     154 </span><span class="lineNoCov">          0 :         flat_mem_p = ADIOI_Flatlist;</span>
<span class="lineNum">     155 </span><span class="lineNoCov">          0 :         while (flat_mem_p-&gt;type != datatype)</span>
<span class="lineNum">     156 </span><span class="lineNoCov">          0 :             flat_mem_p = flat_mem_p-&gt;next;</span>
<span class="lineNum">     157 </span>            :     }
<span class="lineNum">     158 </span>            : 
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :     MPI_Type_extent(fd-&gt;filetype, &amp;filetype_extent);</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :     MPI_Type_size_x(fd-&gt;filetype, &amp;filetype_sz);</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :     if (filetype_extent == filetype_sz) {</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :         flat_file_p = ADIOI_Add_contig_flattened(fd-&gt;filetype);</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :         flat_file_p-&gt;blocklens[0] = memtype_sz*count;</span>
<span class="lineNum">     164 </span><span class="lineNoCov">          0 :         filetype_extent = memtype_sz*count;</span>
<span class="lineNum">     165 </span><span class="lineNoCov">          0 :         filetype_sz = filetype_extent;</span>
<span class="lineNum">     166 </span>            :     }
<span class="lineNum">     167 </span>            :     else {
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :         flat_file_p = ADIOI_Flatlist;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :         while (flat_file_p-&gt;type != fd-&gt;filetype)</span>
<span class="lineNum">     170 </span><span class="lineNoCov">          0 :             flat_file_p = flat_file_p-&gt;next;</span>
<span class="lineNum">     171 </span>            :     }
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[0] = fd-&gt;fp_ind;</span>
<span class="lineNum">     174 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[1] = fd-&gt;disp;</span>
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[2] = off;</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[3] = memtype_sz*count;</span>
<span class="lineNum">     177 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[4] = (ADIO_Offset) filetype_extent;</span>
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :     disp_off_sz_ext_typesz[5] = (ADIO_Offset) filetype_sz;</span>
<span class="lineNum">     179 </span>            : 
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     181 </span><span class="lineNoCov">          0 :         recv_count_arr = ADIOI_Calloc(nprocs, sizeof(amount_and_extra_data_t));</span>
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :         send_count_arr = ADIOI_Calloc(nprocs, sizeof(amount_and_extra_data_t));</span>
<span class="lineNum">     183 </span>            :     } else {
<span class="lineNum">     184 </span><span class="lineNoCov">          0 :         send_count_arr = ADIOI_Calloc(fd-&gt;hints-&gt;cb_nodes,</span>
<span class="lineNum">     185 </span>            :                                   sizeof(amount_and_extra_data_t));
<span class="lineNum">     186 </span>            : 
<span class="lineNum">     187 </span>            :         /* only aggregators receive data */
<span class="lineNum">     188 </span><span class="lineNoCov">          0 :         if (fd-&gt;is_agg) {</span>
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :             recv_count_arr = ADIOI_Calloc(nprocs,</span>
<span class="lineNum">     190 </span>            :                             sizeof(amount_and_extra_data_t));
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :             recv_req_arr = ADIOI_Malloc (nprocs * sizeof(MPI_Request));</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :             for (i=0; i &lt; nprocs; i++)</span>
<span class="lineNum">     193 </span><span class="lineNoCov">          0 :                 MPI_Irecv (&amp;recv_count_arr[i], sizeof(amount_and_extra_data_t),</span>
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :                        MPI_BYTE, i, COUNT_EXCH, fd-&gt;comm, &amp;recv_req_arr[i]);</span>
<span class="lineNum">     195 </span>            :         }
<span class="lineNum">     196 </span>            : 
<span class="lineNum">     197 </span>            :         /* only send data to aggregators */
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :         send_req_arr = ADIOI_Calloc (fd-&gt;hints-&gt;cb_nodes, sizeof(MPI_Request));</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :         for (i=0; i &lt; fd-&gt;hints-&gt;cb_nodes; i++) {</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :             send_count_arr[i].count    = flat_file_p-&gt;count;</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :             send_count_arr[i].fp_ind   = disp_off_sz_ext_typesz[0];</span>
<span class="lineNum">     202 </span><span class="lineNoCov">          0 :             send_count_arr[i].disp     = disp_off_sz_ext_typesz[1];</span>
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :             send_count_arr[i].byte_off = disp_off_sz_ext_typesz[2];</span>
<span class="lineNum">     204 </span><span class="lineNoCov">          0 :             send_count_arr[i].sz       = disp_off_sz_ext_typesz[3];</span>
<span class="lineNum">     205 </span><span class="lineNoCov">          0 :             send_count_arr[i].ext      = disp_off_sz_ext_typesz[4];</span>
<span class="lineNum">     206 </span><span class="lineNoCov">          0 :             send_count_arr[i].type_sz  = disp_off_sz_ext_typesz[5];</span>
<span class="lineNum">     207 </span><span class="lineNoCov">          0 :             MPI_Isend (&amp;send_count_arr[i], sizeof(amount_and_extra_data_t),</span>
<span class="lineNum">     208 </span><span class="lineNoCov">          0 :                    MPI_BYTE, fd-&gt;hints-&gt;ranklist[i], COUNT_EXCH, fd-&gt;comm,</span>
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :                    &amp;send_req_arr[i]);</span>
<span class="lineNum">     210 </span>            :         }
<span class="lineNum">     211 </span>            :     }
<span class="lineNum">     212 </span>            : 
<span class="lineNum">     213 </span>            : 
<span class="lineNum">     214 </span>            :     /* Every client has to build mem and file view_states for each aggregator.
<span class="lineNum">     215 </span>            :      * We initialize their values here.  and we also initialize
<span class="lineNum">     216 </span>            :      * send_count_arr */
<span class="lineNum">     217 </span>            : 
<span class="lineNum">     218 </span><span class="lineNoCov">          0 :     if (memtype_is_contig) {</span>
<span class="lineNum">     219 </span>            :         /* if memory is contigous, we now replace memtype_sz and
<span class="lineNum">     220 </span>            :          * memtype_extent with the full access size */
<span class="lineNum">     221 </span><span class="lineNoCov">          0 :         memtype_sz *= count;</span>
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         memtype_extent = memtype_sz;</span>
<span class="lineNum">     223 </span>            :     }
<span class="lineNum">     224 </span>            : 
<span class="lineNum">     225 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; fd-&gt;hints-&gt;cb_nodes; i++)</span>
<span class="lineNum">     226 </span>            :     {
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :         int tmp_agg_idx = fd-&gt;hints-&gt;ranklist[i];</span>
<span class="lineNum">     228 </span><span class="lineNoCov">          0 :         memset(&amp;(my_mem_view_state_arr[tmp_agg_idx]), 0, sizeof(view_state));</span>
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :         my_mem_view_state_arr[tmp_agg_idx].sz          =</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[3];</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         my_mem_view_state_arr[tmp_agg_idx].ext         =</span>
<span class="lineNum">     232 </span><span class="lineNoCov">          0 :             (ADIO_Offset) memtype_extent;</span>
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :         my_mem_view_state_arr[tmp_agg_idx].type_sz     =</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :             (ADIO_Offset) memtype_sz;</span>
<span class="lineNum">     235 </span><span class="lineNoCov">          0 :         my_mem_view_state_arr[tmp_agg_idx].flat_type_p = flat_mem_p;</span>
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     237 </span>            :                         1,
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :                         &amp;(my_mem_view_state_arr[tmp_agg_idx]),</span>
<span class="lineNum">     239 </span>            :                         TEMP_OFF);
<span class="lineNum">     240 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     241 </span>            :                         1,
<span class="lineNum">     242 </span><span class="lineNoCov">          0 :                         &amp;(my_mem_view_state_arr[tmp_agg_idx]),</span>
<span class="lineNum">     243 </span>            :                         REAL_OFF);
<span class="lineNum">     244 </span>            : 
<span class="lineNum">     245 </span><span class="lineNoCov">          0 :         memset(&amp;(agg_file_view_state_arr[tmp_agg_idx]), 0, sizeof(view_state));</span>
<span class="lineNum">     246 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].fp_ind    =</span>
<span class="lineNum">     247 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[0];</span>
<span class="lineNum">     248 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].disp      =</span>
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[1];</span>
<span class="lineNum">     250 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].byte_off  =</span>
<span class="lineNum">     251 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[2];</span>
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].sz        =</span>
<span class="lineNum">     253 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[3];</span>
<span class="lineNum">     254 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].ext       =</span>
<span class="lineNum">     255 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[4];</span>
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].type_sz   =</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :             disp_off_sz_ext_typesz[5];</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         agg_file_view_state_arr[tmp_agg_idx].flat_type_p = flat_file_p;</span>
<span class="lineNum">     259 </span>            : 
<span class="lineNum">     260 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     261 </span>            :                         1,
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :                         &amp;(agg_file_view_state_arr[tmp_agg_idx]),</span>
<span class="lineNum">     263 </span>            :                         TEMP_OFF);
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     265 </span>            :                         1,
<span class="lineNum">     266 </span><span class="lineNoCov">          0 :                         &amp;(agg_file_view_state_arr[tmp_agg_idx]),</span>
<span class="lineNum">     267 </span>            :                         REAL_OFF);
<span class="lineNum">     268 </span>            : 
<span class="lineNum">     269 </span><span class="lineNoCov">          0 :         if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     270 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].count    = flat_file_p-&gt;count;</span>
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].fp_ind   = disp_off_sz_ext_typesz[0];</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].disp     = disp_off_sz_ext_typesz[1];</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].byte_off = disp_off_sz_ext_typesz[2];</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].sz       = disp_off_sz_ext_typesz[3];</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].ext      = disp_off_sz_ext_typesz[4];</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :             send_count_arr[tmp_agg_idx].type_sz  = disp_off_sz_ext_typesz[5];</span>
<span class="lineNum">     277 </span>            :         }
<span class="lineNum">     278 </span>            :     }
<span class="lineNum">     279 </span>            : 
<span class="lineNum">     280 </span>            : #ifdef DEBUG2
<span class="lineNum">     281 </span>            :     fprintf(stderr, &quot;my own flattened memtype: &quot;);
<span class="lineNum">     282 </span>            :     ADIOI_Print_flatlist_node(flat_mem_p);
<span class="lineNum">     283 </span>            :     fprintf(stderr, &quot;my own flattened filetype: &quot;);
<span class="lineNum">     284 </span>            :     ADIOI_Print_flatlist_node(flat_file_p);
<span class="lineNum">     285 </span>            : #endif
<span class="lineNum">     286 </span>            : 
<span class="lineNum">     287 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     288 </span><span class="lineNoCov">          0 :         ret = MPI_Alltoall(send_count_arr, sizeof(amount_and_extra_data_t),</span>
<span class="lineNum">     289 </span>            :                        MPI_BYTE,
<span class="lineNum">     290 </span>            :                        recv_count_arr, sizeof(amount_and_extra_data_t),
<span class="lineNum">     291 </span>            :                        MPI_BYTE, fd-&gt;comm);
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         if (ret != MPI_SUCCESS)</span>
<span class="lineNum">     293 </span>            :         {
<span class="lineNum">     294 </span><span class="lineNoCov">          0 :             fprintf(stderr, &quot;ADIOI_Exchange_file_views: MPI_Alltoall failed &quot;</span>
<span class="lineNum">     295 </span>            :                 &quot;with error %d&quot;, ret);
<span class="lineNum">     296 </span><span class="lineNoCov">          0 :             return;</span>
<span class="lineNum">     297 </span>            :         }
<span class="lineNum">     298 </span>            :     } else {
<span class="lineNum">     299 </span><span class="lineNoCov">          0 :         statuses = (MPI_Status *) ADIOI_Malloc(1 + nprocs * sizeof(MPI_Status));</span>
<span class="lineNum">     300 </span><span class="lineNoCov">          0 :         if (fd-&gt;is_agg) {</span>
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :             MPI_Waitall(nprocs, recv_req_arr, statuses);</span>
<span class="lineNum">     302 </span><span class="lineNoCov">          0 :             ADIOI_Free(recv_req_arr);</span>
<span class="lineNum">     303 </span>            :         }
<span class="lineNum">     304 </span><span class="lineNoCov">          0 :         MPI_Waitall(fd-&gt;hints-&gt;cb_nodes, send_req_arr, statuses);</span>
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :         ADIOI_Free(statuses);</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :         ADIOI_Free(send_req_arr);</span>
<span class="lineNum">     307 </span>            :     }
<span class="lineNum">     308 </span>            : #ifdef DEBUG2
<span class="lineNum">     309 </span>            :     if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {
<span class="lineNum">     310 </span>            :         fprintf(stderr, &quot;send_count_arr:&quot;);
<span class="lineNum">     311 </span>            :         for (i = 0; i &lt; nprocs; i++)
<span class="lineNum">     312 </span>            :         {
<span class="lineNum">     313 </span>            :             fprintf(stderr, &quot;[%d]=%d &quot;, i, send_count_arr[i].count);
<span class="lineNum">     314 </span>            :         }
<span class="lineNum">     315 </span>            :         fprintf(stderr, &quot;\n&quot;);
<span class="lineNum">     316 </span>            :         fprintf(stderr, &quot;recv_count_arr:&quot;);
<span class="lineNum">     317 </span>            :         for (i = 0; i &lt; nprocs; i++)
<span class="lineNum">     318 </span>            :         {
<span class="lineNum">     319 </span>            :             fprintf(stderr, &quot;[%d]=%d &quot;, i, recv_count_arr[i].count);
<span class="lineNum">     320 </span>            :         }
<span class="lineNum">     321 </span>            :         fprintf(stderr, &quot;\n&quot;);
<span class="lineNum">     322 </span>            :     } else {
<span class="lineNum">     323 </span>            :         fprintf(stderr, &quot;send_count_arr:&quot;);
<span class="lineNum">     324 </span>            :         for (i = 0; i &lt; fd-&gt;hints-&gt;cb_nodes; i++)
<span class="lineNum">     325 </span>            :         {
<span class="lineNum">     326 </span>            :             fprintf(stderr, &quot;[%d]=%d &quot;, i, send_count_arr[i].count);
<span class="lineNum">     327 </span>            :         }
<span class="lineNum">     328 </span>            :         fprintf(stderr, &quot;\n&quot;);
<span class="lineNum">     329 </span>            :         if (fd-&gt;is_agg) {
<span class="lineNum">     330 </span>            :             fprintf(stderr, &quot;recv_count_arr:&quot;);
<span class="lineNum">     331 </span>            :             for (i = 0; i &lt; nprocs; i++)
<span class="lineNum">     332 </span>            :             {
<span class="lineNum">     333 </span>            :                 fprintf(stderr, &quot;[%d]=%d &quot;, i, recv_count_arr[i].count);
<span class="lineNum">     334 </span>            :             }
<span class="lineNum">     335 </span>            :             fprintf(stderr, &quot;\n&quot;);
<span class="lineNum">     336 </span>            :         }
<span class="lineNum">     337 </span>            :     }
<span class="lineNum">     338 </span>            : #endif
<span class="lineNum">     339 </span>            : 
<span class="lineNum">     340 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_alltoall == ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     341 </span><span class="lineNoCov">          0 :         for (i=0; i &lt; fd-&gt;hints-&gt;cb_nodes; i++)</span>
<span class="lineNum">     342 </span><span class="lineNoCov">          0 :             if (send_count_arr[i].count &gt; 0)</span>
<span class="lineNum">     343 </span><span class="lineNoCov">          0 :                 send_req_arr_sz++;</span>
<span class="lineNum">     344 </span>            :     }
<span class="lineNum">     345 </span>            :     /* Figure out how many counts to send/recv */
<span class="lineNum">     346 </span><span class="lineNoCov">          0 :     for (i = 0; i &lt; nprocs; i++)</span>
<span class="lineNum">     347 </span>            :     {
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :         if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     349 </span><span class="lineNoCov">          0 :             if (send_count_arr[i].count &gt; 0)</span>
<span class="lineNum">     350 </span><span class="lineNoCov">          0 :                 send_req_arr_sz++;</span>
<span class="lineNum">     351 </span>            :         }
<span class="lineNum">     352 </span>            :         /* Only aggregators should recv*/
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :         if (fd-&gt;is_agg) {</span>
<span class="lineNum">     354 </span><span class="lineNoCov">          0 :             if (recv_count_arr[i].count &gt; 0)</span>
<span class="lineNum">     355 </span>            :             {
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :                 if ((client_file_view_state_arr[i].flat_type_p =</span>
<span class="lineNum">     357 </span><span class="lineNoCov">          0 :                      (ADIOI_Flatlist_node *) ADIOI_Malloc(</span>
<span class="lineNum">     358 </span>            :                          sizeof(ADIOI_Flatlist_node))) == NULL)
<span class="lineNum">     359 </span>            :                 {
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :                     fprintf(stderr, &quot;ADIOI_Exchange_file_views: malloc &quot;</span>
<span class="lineNum">     361 </span>            :                             &quot;flat_type_p failed\n&quot;);
<span class="lineNum">     362 </span>            :                 }
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :                 client_file_view_state_arr[i].flat_type_p-&gt;count =</span>
<span class="lineNum">     364 </span><span class="lineNoCov">          0 :                     recv_count_arr[i].count;</span>
<span class="lineNum">     365 </span><span class="lineNoCov">          0 :                 client_file_view_state_arr[i].flat_type_p-&gt;indices =</span>
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :                     (ADIO_Offset *) ADIOI_Calloc(recv_count_arr[i].count,</span>
<span class="lineNum">     367 </span>            :                                                  sizeof(ADIO_Offset));
<span class="lineNum">     368 </span><span class="lineNoCov">          0 :                 client_file_view_state_arr[i].flat_type_p-&gt;blocklens =</span>
<span class="lineNum">     369 </span><span class="lineNoCov">          0 :                     (ADIO_Offset *) ADIOI_Calloc(recv_count_arr[i].count,</span>
<span class="lineNum">     370 </span>            :                                     sizeof(ADIO_Offset));
<span class="lineNum">     371 </span>            : 
<span class="lineNum">     372 </span>            :                 /* Copy the extra data out of the stuff we Alltoall'd */
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :                 memcpy (&amp;client_file_view_state_arr[i].fp_ind,</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :                         &amp;recv_count_arr[i].fp_ind,</span>
<span class="lineNum">     375 </span>            :                         6*sizeof(ADIO_Offset));
<span class="lineNum">     376 </span>            : 
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :                 recv_req_arr_sz++;</span>
<span class="lineNum">     378 </span>            :             }
<span class="lineNum">     379 </span>            :         }
<span class="lineNum">     380 </span>            :     }
<span class="lineNum">     381 </span>            : 
<span class="lineNum">     382 </span>            :     /* Since ADIOI_Calloc may do other things we add the +1
<span class="lineNum">     383 </span>            :      * to avoid a 0-size malloc */
<span class="lineNum">     384 </span><span class="lineNoCov">          0 :     send_req_arr = (MPI_Request *) ADIOI_Calloc(2*(send_req_arr_sz)+1,</span>
<span class="lineNum">     385 </span>            :                                                 sizeof(MPI_Request));
<span class="lineNum">     386 </span>            : 
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :     j = 0;</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :     if (recv_req_arr_sz &gt; 0) {</span>
<span class="lineNum">     389 </span><span class="lineNoCov">          0 :         assert (fd-&gt;is_agg);</span>
<span class="lineNum">     390 </span><span class="lineNoCov">          0 :         recv_req_arr = (MPI_Request *) ADIOI_Calloc(2*(recv_req_arr_sz),</span>
<span class="lineNum">     391 </span>            :                                                     sizeof(MPI_Request));
<span class="lineNum">     392 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; nprocs; i++) {</span>
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :             if (recv_count_arr[i].count &gt; 0) {</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :                 MPI_Irecv(client_file_view_state_arr[i].flat_type_p-&gt;indices,</span>
<span class="lineNum">     395 </span><span class="lineNoCov">          0 :                           recv_count_arr[i].count, ADIO_OFFSET, i,</span>
<span class="lineNum">     396 </span><span class="lineNoCov">          0 :                           INDICES, fd-&gt;comm, &amp;recv_req_arr[j]);</span>
<span class="lineNum">     397 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     398 </span><span class="lineNoCov">          0 :                 MPI_Irecv(client_file_view_state_arr[i].flat_type_p-&gt;blocklens,</span>
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :                           recv_count_arr[i].count, ADIO_OFFSET, i,</span>
<span class="lineNum">     400 </span><span class="lineNoCov">          0 :                           BLOCK_LENS, fd-&gt;comm, &amp;recv_req_arr[j]);</span>
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     402 </span>            :             }
<span class="lineNum">     403 </span>            :         }
<span class="lineNum">     404 </span>            :     }
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :     if (fd-&gt;hints-&gt;cb_alltoall != ADIOI_HINT_DISABLE) {</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :         j = 0;</span>
<span class="lineNum">     408 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; nprocs; i++) {</span>
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :             if (send_count_arr[i].count &gt; 0) {</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :                 MPI_Isend(flat_file_p-&gt;indices,</span>
<span class="lineNum">     411 </span><span class="lineNoCov">          0 :                       send_count_arr[i].count, ADIO_OFFSET, i,</span>
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :                       INDICES, fd-&gt;comm, &amp;send_req_arr[j]);</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     414 </span><span class="lineNoCov">          0 :                 MPI_Isend(flat_file_p-&gt;blocklens,</span>
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :                       send_count_arr[i].count, ADIO_OFFSET, i,</span>
<span class="lineNum">     416 </span><span class="lineNoCov">          0 :                       BLOCK_LENS, fd-&gt;comm, &amp;send_req_arr[j]);</span>
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     418 </span>            :             }
<span class="lineNum">     419 </span>            :         }
<span class="lineNum">     420 </span>            :     } else {
<span class="lineNum">     421 </span><span class="lineNoCov">          0 :         j = 0;</span>
<span class="lineNum">     422 </span><span class="lineNoCov">          0 :         for (i = 0; i &lt; fd-&gt;hints-&gt;cb_nodes; i++) {</span>
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :             if (send_count_arr[i].count &gt; 0) {</span>
<span class="lineNum">     424 </span><span class="lineNoCov">          0 :                 MPI_Isend(flat_file_p-&gt;indices,</span>
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :                       send_count_arr[i].count, ADIO_OFFSET,</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :                       fd-&gt;hints-&gt;ranklist[i], INDICES, fd-&gt;comm,</span>
<span class="lineNum">     427 </span><span class="lineNoCov">          0 :                       &amp;send_req_arr[j]);</span>
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :                 MPI_Isend(flat_file_p-&gt;blocklens,</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :                       send_count_arr[i].count, ADIO_OFFSET,</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :                       fd-&gt;hints-&gt;ranklist[i], BLOCK_LENS, fd-&gt;comm,</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :                       &amp;send_req_arr[j]);</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :                 j++;</span>
<span class="lineNum">     434 </span>            :             }
<span class="lineNum">     435 </span>            :         }
<span class="lineNum">     436 </span>            :     }
<span class="lineNum">     437 </span>            : 
<span class="lineNum">     438 </span>            :     /* Since ADIOI_Malloc may do other things we add the +1
<span class="lineNum">     439 </span>            :      * to avoid a 0-size malloc */
<span class="lineNum">     440 </span><span class="lineNoCov">          0 :     statuses = (MPI_Status *)</span>
<span class="lineNum">     441 </span><span class="lineNoCov">          0 :         ADIOI_Malloc(1 + 2 * ADIOI_MAX(send_req_arr_sz,recv_req_arr_sz)</span>
<span class="lineNum">     442 </span>            :                      * sizeof(MPI_Status));
<span class="lineNum">     443 </span>            : 
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :     if (send_req_arr_sz &gt; 0) {</span>
<span class="lineNum">     445 </span><span class="lineNoCov">          0 :         MPI_Waitall(2 * send_req_arr_sz, send_req_arr, statuses);</span>
<span class="lineNum">     446 </span><span class="lineNoCov">          0 :         ADIOI_Free(send_count_arr);</span>
<span class="lineNum">     447 </span><span class="lineNoCov">          0 :         ADIOI_Free(send_req_arr);</span>
<span class="lineNum">     448 </span>            :     }
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :     if (recv_req_arr_sz &gt; 0) {</span>
<span class="lineNum">     450 </span><span class="lineNoCov">          0 :         MPI_Waitall(2 * recv_req_arr_sz, recv_req_arr, statuses);</span>
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :         ADIOI_Free(recv_count_arr);</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 :         ADIOI_Free(recv_req_arr);</span>
<span class="lineNum">     453 </span>            :     }
<span class="lineNum">     454 </span><span class="lineNoCov">          0 :     ADIOI_Free(statuses);</span>
<span class="lineNum">     455 </span>            : 
<span class="lineNum">     456 </span><span class="lineNoCov">          0 :     if (fd-&gt;is_agg == 1)</span>
<span class="lineNum">     457 </span>            :     {
<span class="lineNum">     458 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     459 </span>            :                         nprocs,
<span class="lineNum">     460 </span>            :                         client_file_view_state_arr,
<span class="lineNum">     461 </span>            :                         TEMP_OFF);
<span class="lineNum">     462 </span><span class="lineNoCov">          0 :         ADIOI_init_view_state(file_ptr_type,</span>
<span class="lineNum">     463 </span>            :                         nprocs,
<span class="lineNum">     464 </span>            :                         client_file_view_state_arr,
<span class="lineNum">     465 </span>            :                         REAL_OFF);
<span class="lineNum">     466 </span>            :     }
<span class="lineNum">     467 </span>            : 
<span class="lineNum">     468 </span>            : #ifdef DEBUG
<span class="lineNum">     469 </span>            :     if (fd-&gt;is_agg == 1)
<span class="lineNum">     470 </span>            :     {
<span class="lineNum">     471 </span>            :         ADIOI_Flatlist_node *fr_node_p = ADIOI_Flatlist;
<span class="lineNum">     472 </span>            :         for (i = 0; i &lt; nprocs; i++)
<span class="lineNum">     473 </span>            :         {
<span class="lineNum">     474 </span>            :             fprintf(stderr, &quot;client_file_view_state_arr[%d]=(fp_ind=%Ld,&quot;
<span class="lineNum">     475 </span>            :                     &quot;disp=%Ld,byte_off=%Ld,sz=%Ld,ext=%Ld\n&quot;, i,
<span class="lineNum">     476 </span>            :                     client_file_view_state_arr[i].fp_ind,
<span class="lineNum">     477 </span>            :                     client_file_view_state_arr[i].disp,
<span class="lineNum">     478 </span>            :                     client_file_view_state_arr[i].byte_off,
<span class="lineNum">     479 </span>            :                     client_file_view_state_arr[i].sz,
<span class="lineNum">     480 </span>            :                     client_file_view_state_arr[i].ext);
<span class="lineNum">     481 </span>            :         }
<span class="lineNum">     482 </span>            : 
<span class="lineNum">     483 </span>            :         while (fr_node_p-&gt;type !=
<span class="lineNum">     484 </span>            :                fd-&gt;file_realm_types[fd-&gt;my_cb_nodes_index])
<span class="lineNum">     485 </span>            :             fr_node_p = fr_node_p-&gt;next;
<span class="lineNum">     486 </span>            :         assert(fr_node_p != NULL);
<span class="lineNum">     487 </span>            : 
<span class="lineNum">     488 </span>            :         fprintf(stderr, &quot;my file realm (idx=%d,st_off=%Ld) &quot;,
<span class="lineNum">     489 </span>            :                 fd-&gt;my_cb_nodes_index,
<span class="lineNum">     490 </span>            :                 fd-&gt;file_realm_st_offs[fd-&gt;my_cb_nodes_index]);
<span class="lineNum">     491 </span>            :         ADIOI_Print_flatlist_node(fr_node_p);
<span class="lineNum">     492 </span>            :     }
<span class="lineNum">     493 </span>            : #endif
<span class="lineNum">     494 </span>            : 
<span class="lineNum">     495 </span>            : #ifdef DEBUG2
<span class="lineNum">     496 </span>            :     if (fd-&gt;is_agg == 1)
<span class="lineNum">     497 </span>            :     {
<span class="lineNum">     498 </span>            :         for (i = 0; i &lt; nprocs; i++)
<span class="lineNum">     499 </span>            :         {
<span class="lineNum">     500 </span>            :             fprintf(stderr, &quot;client_file_view_state_arr[%d]: &quot;, i);
<span class="lineNum">     501 </span>            :             ADIOI_Print_flatlist_node(
<span class="lineNum">     502 </span>            :                 client_file_view_state_arr[i].flat_type_p);
<span class="lineNum">     503 </span>            :         }
<span class="lineNum">     504 </span>            :     }
<span class="lineNum">     505 </span>            : #endif
<span class="lineNum">     506 </span>            : #ifdef AGGREGATION_PROFILE
<span class="lineNum">     507 </span>            :     MPE_Log_event (5015, 0, NULL);
<span class="lineNum">     508 </span>            : #endif
<span class="lineNum">     509 </span>            : }
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../../../../../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.11</a></td></tr>
  </table>
  <br>

</body>
</html>
